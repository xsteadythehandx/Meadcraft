<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Meadcraft">
<meta name="mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#0e0c0a">
<title>Meadcraft â€” Mead Brewing Companion</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ¯</text></svg>">
<link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:ital,wght@0,300;0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">
<style>
* { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
html, body, #root { background: #0e0c0a; min-height: 100vh; min-height: 100dvh; }
body { padding-bottom: env(safe-area-inset-bottom); }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const { useState, useEffect, useCallback, useMemo } = React;


// localStorage persistence wrapper
const usePersistedState = (key, initial) => {
  const [val, setVal] = React.useState(() => {
    try { const s = localStorage.getItem(key); return s ? JSON.parse(s) : initial; }
    catch { return initial; }
  });
  React.useEffect(() => { try { localStorage.setItem(key, JSON.stringify(val)); } catch {} }, [val]);
  return [val, setVal];
};




// â”€â”€â”€ Data Constants â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

const YEAST_DB = [
  { id: "71b", name: "Lalvin 71B-1122", tolerance: 14, character: "Fruity, smooth", best: "Melomels, session meads", tempRange: "59-86Â°F", notes: "Metabolizes malic acid, softening fruit meads. Great for beginners." },
  { id: "d47", name: "Lalvin D-47", tolerance: 14, character: "Floral, spicy", best: "Traditional, metheglin", tempRange: "59-68Â°F", notes: "Enhances mouthfeel. Keep temps LOW or it produces fusels. Ages well." },
  { id: "k1v", name: "Lalvin K1-V1116", tolerance: 18, character: "Clean, neutral", best: "High ABV meads, stuck ferments", tempRange: "59-86Â°F", notes: "Very strong fermenter. Will go bone dry if given enough nutrients." },
  { id: "ec1118", name: "Lalvin EC-1118", tolerance: 18, character: "Very clean, neutral", best: "Sparkling mead, high ABV, restarts", tempRange: "50-86Â°F", notes: "The workhorse. Ferments fast and clean. Can strip delicate flavors." },
  { id: "qa23", name: "Lalvin QA23", tolerance: 16, character: "Clean, tropical hints", best: "Fruit meads, hydromel", tempRange: "59-90Â°F", notes: "Preserves fruit aromatics. Good nutrient needs." },
  { id: "dv10", name: "Lalvin DV10", tolerance: 18, character: "Very clean", best: "Sparkling, high ABV", tempRange: "50-95Â°F", notes: "Champagne-style yeast. Fast fermentation." },
  { id: "rc212", name: "Lalvin RC-212", tolerance: 14, character: "Berry, earthy", best: "Dark fruit melomels", tempRange: "64-86Â°F", notes: "Brings out red fruit character. Moderate fermenter." },
  { id: "us05", name: "Safale US-05", tolerance: 11, character: "Clean, mild", best: "Braggots, low ABV session", tempRange: "59-75Â°F", notes: "Ale yeast. Great for braggots and low-gravity brews." },
];

const HONEY_TYPES = [
  { name: "Wildflower", flavor: "Complex, floral", color: "Amber", gravity: 1.035, notes: "Most common. Great all-around choice.", intensity: "medium" },
  { name: "Clover", flavor: "Mild, sweet", color: "Light", gravity: 1.035, notes: "Very mild, lets other ingredients shine.", intensity: "light" },
  { name: "Orange Blossom", flavor: "Citrusy, light", color: "Light amber", gravity: 1.035, notes: "Classic choice for traditionals and melomels.", intensity: "light" },
  { name: "Buckwheat", flavor: "Bold, molasses-like", color: "Dark", gravity: 1.035, notes: "Very strong flavor. Use sparingly or blend.", intensity: "heavy" },
  { name: "Mesquite", flavor: "Earthy, smoky", color: "Medium", gravity: 1.035, notes: "Unique southwestern character.", intensity: "heavy" },
  { name: "Tupelo", flavor: "Smooth, buttery", color: "Light amber", gravity: 1.035, notes: "Premium honey. Never crystallizes.", intensity: "medium" },
  { name: "Meadowfoam", flavor: "Vanilla, marshmallow", color: "Light", gravity: 1.035, notes: "Distinct vanilla note. Great for dessert meads.", intensity: "medium" },
];

const MEAD_TYPES = {
  traditional: { name: "Traditional Mead (Show Mead)", desc: "Honey, water, yeast â€” pure and simple", icon: "ğŸ¯" },
  melomel: { name: "Melomel", desc: "Mead with fruit", icon: "ğŸ‡" },
  metheglin: { name: "Metheglin", desc: "Mead with herbs/spices", icon: "ğŸŒ¿" },
  cyser: { name: "Cyser", desc: "Mead with apple juice/cider", icon: "ğŸ" },
  pyment: { name: "Pyment", desc: "Mead with grape juice", icon: "ğŸ·" },
  braggot: { name: "Braggot", desc: "Mead with malt/hops", icon: "ğŸº" },
  melomelMetheglin: { name: "Metheglin Melomel", desc: "Mead with fruit AND spices", icon: "ğŸŒ¶ï¸" },
  capsicumel: { name: "Capsicumel", desc: "Mead with hot peppers", icon: "ğŸ”¥" },
  bochet: { name: "Bochet", desc: "Mead with caramelized honey", icon: "ğŸ«•" },
  acerglyn: { name: "Acerglyn", desc: "Mead with maple syrup", icon: "ğŸ" },
  rhodomel: { name: "Rhodomel", desc: "Mead with rose petals", icon: "ğŸŒ¹" },
};

const SWEETNESS_LEVELS = [
  { id: "dry", name: "Dry", fg: "0.990 â€“ 1.006", desc: "No residual sweetness, crisp finish", ogAdjust: 0 },
  { id: "semi-sweet", name: "Semi-Sweet", fg: "1.006 â€“ 1.015", desc: "Slight sweetness, balanced", ogAdjust: 0.008 },
  { id: "sweet", name: "Sweet", fg: "1.015 â€“ 1.025", desc: "Noticeably sweet, dessert-like", ogAdjust: 0.018 },
  { id: "very-sweet", name: "Very Sweet (Sack)", fg: "1.025 â€“ 1.050", desc: "Very sweet, thick, rich", ogAdjust: 0.035 },
];

const ABV_RANGES = [
  { id: "session", name: "Session / Hydromel", range: "3â€“7%", target: 5, desc: "Light, refreshing, quick to drink" },
  { id: "standard", name: "Standard", range: "7â€“14%", target: 11, desc: "Classic mead strength" },
  { id: "strong", name: "Strong / Sack", range: "14â€“18%", target: 16, desc: "Bold, rich, needs aging" },
];

const FRUIT_ADDITIONS = [
  "Strawberry", "Blueberry", "Raspberry", "Blackberry", "Cherry", "Peach",
  "Mango", "Pineapple", "Pomegranate", "Cranberry", "Fig", "Elderberry",
  "Passionfruit", "Lemon", "Orange", "Lime", "Grapefruit", "Plum",
  "Apricot", "Banana", "Coconut", "Dragonfruit",
];

const SPICE_ADDITIONS = [
  "Cinnamon", "Vanilla Bean", "Ginger", "Clove", "Nutmeg", "Star Anise",
  "Cardamom", "Black Pepper", "Allspice", "Coriander", "Lavender",
  "Rose Petals", "Hibiscus", "Chamomile", "Rosemary", "Thyme", "Sage",
  "Juniper Berry", "Oak Chips", "Cocoa Nibs", "Coffee Beans", "Tea (Earl Grey)",
  "Saffron", "Lemongrass", "Mint", "Basil", "Bay Leaf",
];

const LIQUID_BASES = [
  { id: "water", name: "Spring Water", desc: "Classic choice. Lets honey shine.", icon: "ğŸ’§", notes: "Use non-chlorinated spring or filtered water. Never tap water with chlorine." },
  { id: "apple-cider", name: "Apple Cider", desc: "Makes a Cyser. Adds body & apple flavor.", icon: "ğŸ", notes: "Use fresh-pressed or preservative-free cider. Pasteurized is fine. Adds fermentable sugar â€” may increase ABV slightly." },
  { id: "apple-juice", name: "Apple Juice", desc: "Lighter cyser. Milder than cider.", icon: "ğŸ§ƒ", notes: "Make sure it has NO preservatives (potassium sorbate will prevent fermentation). Organic is safest." },
  { id: "grape-juice", name: "Grape Juice", desc: "Makes a Pyment. Wine-like character.", icon: "ğŸ‡", notes: "Use 100% juice with no preservatives. Red grape juice adds tannin and color. White is more delicate." },
  { id: "cherry-juice", name: "Cherry Juice", desc: "Rich, tart base. Beautiful color.", icon: "ğŸ’", notes: "Tart cherry juice works best. Very flavorful â€” can use 50/50 with water if you want subtler fruit." },
  { id: "cranberry-juice", name: "Cranberry Juice", desc: "Tart and vibrant. Bold pink color.", icon: "ğŸ«", notes: "Very tart! Best with semi-sweet or sweet recipes. Use 100% juice, not cocktail." },
  { id: "pomegranate-juice", name: "Pomegranate Juice", desc: "Deep, fruity, tannic.", icon: "ğŸ«’", notes: "Adds beautiful color and natural tannins. POM Wonderful works but check for preservatives." },
  { id: "tea", name: "Brewed Tea", desc: "Adds tannin and complexity.", icon: "ğŸ«–", notes: "Black tea adds tannin structure. Green tea is more delicate. Brew strong, cool completely before using." },
  { id: "coffee", name: "Cold Brew Coffee", desc: "Bold, roasty base.", icon: "â˜•", notes: "Use cold brew concentrate diluted to taste. Hot-brewed coffee can add bitterness. Start with 25-50% coffee, rest water." },
  { id: "coconut-water", name: "Coconut Water", desc: "Tropical, mineral-rich.", icon: "ğŸ¥¥", notes: "Adds potassium and a subtle tropical note. Use plain, not flavored." },
  { id: "custom", name: "Custom / Other", desc: "Using something not listed here.", icon: "ğŸ§ª", notes: "Just make sure your liquid has no preservatives (sorbate, sulfites) that would prevent fermentation." },
];

const BEGINNER_TIPS = [
  { icon: "ğŸ§¼", title: "Sanitize Everything", tip: "If it touches your mead, it needs to be sanitized. Star San is your best friend â€” it's no-rinse, cheap, and a little goes a long way. This is the #1 cause of failed batches." },
  { icon: "ğŸŒ¡ï¸", title: "Temperature Matters", tip: "Keep your fermenting mead between 60â€“72Â°F. Too warm = fusel alcohols (harsh, hangover-inducing). Too cold = stalled fermentation. A closet usually works great." },
  { icon: "ğŸ¯", title: "Quality Honey = Quality Mead", tip: "Your mead can only be as good as your honey. Raw, local, unprocessed honey will give you the best flavor. Avoid ultra-filtered supermarket honey if you can." },
  { icon: "â³", title: "Patience is an Ingredient", tip: "Young mead often tastes rough, hot, or weird. Give it time. Most meads need at least 2â€“3 months to start tasting good, and many get dramatically better at 6â€“12 months." },
  { icon: "ğŸ§ª", title: "Feed Your Yeast", tip: "Honey is nutrient-poor. Without proper yeast nutrients (Fermaid-O or Fermaid-K), your yeast will struggle and produce off-flavors. Staggered nutrient additions are key." },
  { icon: "ğŸ“", title: "Take Gravity Readings", tip: "A hydrometer costs $8 and tells you exactly where your fermentation is. Take a reading before pitching (OG) and periodically during â€” it's how you know when you're done." },
  { icon: "ğŸ«§", title: "Degas During Primary", tip: "Stir or swirl your mead vigorously during the first week to release COâ‚‚. Dissolved COâ‚‚ stresses yeast and slows fermentation. Stop degassing after the 1/3 sugar break." },
  { icon: "ğŸš«", title: "Don't Boil Your Honey", tip: "Old recipes say to boil honey. Don't! Boiling drives off delicate aromas and flavors. Just warm your water to dissolve the honey, or even mix it cold â€” the yeast doesn't care." },
  { icon: "ğŸ¶", title: "Minimize Oxygen After Primary", tip: "During primary fermentation, oxygen is fine (even helpful). After that, oxygen is your enemy â€” it causes stale, cardboard-like flavors. Rack gently, keep airlocks full." },
  { icon: "ğŸ§Š", title: "Cold Crashing Helps Clarity", tip: "Before bottling, if you can chill your mead to near-freezing (33â€“38Â°F) for 24â€“48 hours, yeast and haze particles will drop out. You'll get beautiful clear mead." },
  { icon: "ğŸ“", title: "Keep Notes on Everything", tip: "Write down your recipe, OG, dates, temperatures, when you added things, and how it tastes. Future you will thank present you when you want to recreate (or avoid) a batch." },
  { icon: "ğŸ", title: "Add Fruit in Secondary", tip: "Adding fruit after primary fermentation preserves more fresh fruit character. Freeze fruit first to break cell walls for better extraction, and use a sanitized mesh bag for easy removal." },
  { icon: "ğŸŒ¿", title: "Spices: Less is More", tip: "You can always add more spice, but you can't take it out. Start with half of what you think you need, taste after a few days, and add more if desired. Especially with clove and cinnamon." },
  { icon: "ğŸ”¬", title: "Stable Gravity = Done Fermenting", tip: "Take gravity readings 3 days apart. If they're the same, fermentation is complete. Don't just go by airlock activity â€” airlocks can bubble from temperature changes." },
  { icon: "ğŸ§´", title: "Stabilize Before Back-Sweetening", tip: "If you add honey after fermentation without stabilizing (potassium sorbate + campden tablet), the yeast will just eat the new sugar. Stabilize first, wait 24hrs, then sweeten." },
  { icon: "ğŸ«™", title: "Headspace is the Enemy", tip: "When racking to secondary, minimize the air gap above your mead. Use appropriately sized vessels, or top up with similar liquid. Excess headspace = oxidation risk." },
  { icon: "ğŸ·", title: "Glass Over Plastic for Aging", tip: "Plastic buckets are fine for primary, but for secondary/aging, glass carboys are better â€” they're impermeable to oxygen and won't scratch (scratches harbor bacteria)." },
  { icon: "ğŸ’°", title: "Start Small, Start Simple", tip: "Your first mead should be a simple 1-gallon traditional or cyser. Don't go crazy with 12 ingredients on batch #1. Learn the basics, then get creative." },
  { icon: "ğŸ”„", title: "Rack Off the Lees", tip: "Dead yeast (lees) on the bottom can cause off-flavors (autolysis) if left too long. Rack your mead to a clean vessel after primary, and again if more sediment builds up." },
  { icon: "ğŸ«—", title: "Use an Auto-Siphon", tip: "Trying to pour mead between vessels = disaster. An auto-siphon with tubing makes racking easy, clean, and low-oxygen. It's a $12 investment you'll use every single time." },
  { icon: "ğŸ§‚", title: "Water Quality Matters", tip: "Chlorine and chloramine in tap water can create medicinal off-flavors. Use spring water, or treat tap water with a campden tablet to remove chlorine/chloramine." },
  { icon: "ğŸ“¦", title: "Don't Fear the Fruit Flies", tip: "Fruit flies carry acetobacter (vinegar bacteria). Keep your airlock full and your equipment covered during transfers. A single fruit fly can ruin a batch." },
  { icon: "ğŸ¯", title: "Aim for 12% on Your First Batch", tip: "Around 12% ABV is the sweet spot for beginners â€” it's strong enough to be interesting, but not so high that yeast stress becomes an issue. About 3.5 lbs honey per gallon." },
  { icon: "âš¡", title: "Stuck Fermentation? Don't Panic", tip: "If fermentation stalls: 1) Check temperature, 2) Add nutrients if before 1/3 break, 3) Gently stir, 4) As last resort, pitch a strong yeast like EC-1118. Most stalls are fixable." },
  { icon: "ğŸ·ï¸", title: "Label Your Bottles", tip: "It's easy to forget what's in each bottle after a few months. Label with: name, date bottled, ABV, and any tasting notes. You'll build a library of your brewing journey." },
];

const DICTIONARY = [
  { term: "ABV", def: "Alcohol By Volume â€” the percentage of alcohol in your finished mead." },
  { term: "Acerglyn", def: "A mead made with maple syrup in addition to honey." },
  { term: "Adjunct", def: "Any ingredient added beyond honey, water, and yeast (fruits, spices, etc.)." },
  { term: "Aging", def: "Letting mead sit after fermentation to develop flavors and smooth out harshness. Patience pays off!" },
  { term: "Autolysis", def: "Off-flavors caused by dead yeast breaking down. Prevented by racking off the lees." },
  { term: "Back-sweetening", def: "Adding honey or sugar after fermentation to increase sweetness. Must stabilize first!" },
  { term: "Bochet", def: "A mead made with caramelized (cooked) honey, giving toffee/caramel notes." },
  { term: "Braggot", def: "A hybrid of mead and beer â€” made with both honey and malted grains." },
  { term: "Campden Tablet", def: "Potassium metabisulfite tablet used to stabilize mead and prevent wild yeast/bacteria." },
  { term: "Capsicumel", def: "A mead made with hot chili peppers." },
  { term: "Carboy", def: "A large glass or plastic jug (usually 1â€“6 gallons) used as a fermentation vessel." },
  { term: "Cold Crash", def: "Chilling mead to near-freezing to drop yeast and sediment out of suspension for clarity." },
  { term: "Cyser", def: "A mead made with apple juice or cider instead of (or alongside) water." },
  { term: "Degassing", def: "Releasing dissolved COâ‚‚ from mead during fermentation, usually by stirring vigorously." },
  { term: "Dry Mead", def: "Mead with little to no residual sugar, giving a crisp finish (FG below 1.006)." },
  { term: "Fermentation", def: "The process where yeast converts sugar (from honey) into alcohol and COâ‚‚." },
  { term: "Final Gravity (FG)", def: "The specific gravity reading after fermentation. Lower = drier mead, more sugar consumed." },
  { term: "Fining Agent", def: "Substance (bentonite, gelatin, etc.) added to clarify mead by binding to haze particles." },
  { term: "Fusel Alcohols", def: "Harsh, hot-tasting alcohols produced by stressed yeast. Avoided by proper temp control and nutrition." },
  { term: "Hydromel", def: "A low-alcohol mead (typically 3â€“7% ABV). Light, refreshing, quick to make." },
  { term: "Hydrometer", def: "A tool that measures the density (specific gravity) of your must/mead to track fermentation." },
  { term: "Lees", def: "Dead yeast and sediment that settles to the bottom of your fermenter." },
  { term: "Melomel", def: "A mead made with fruit (other than apples or grapes, which have their own names)." },
  { term: "Metheglin", def: "A mead made with herbs and/or spices." },
  { term: "Must", def: "The unfermented mixture of honey and water (and any additions) before/during fermentation." },
  { term: "Nutrient (YAN)", def: "Yeast Assimilable Nitrogen â€” nutrients added to feed yeast. Honey is nutrient-poor, so supplementation is critical." },
  { term: "Original Gravity (OG)", def: "The specific gravity of your must before fermentation begins. Determines potential ABV." },
  { term: "Oxidation", def: "Exposure to oxygen after fermentation, causing stale or cardboard-like off-flavors." },
  { term: "Pitching", def: "Adding yeast to your must to begin fermentation." },
  { term: "Primary Fermentation", def: "The first, most vigorous phase of fermentation (typically 2â€“4 weeks)." },
  { term: "Potassium Sorbate", def: "A stabilizer that prevents yeast from reproducing. Used before back-sweetening." },
  { term: "Pyment", def: "A mead made with grape juice." },
  { term: "Racking", def: "Transferring mead from one vessel to another, leaving sediment behind. Key for clarity." },
  { term: "Rhodomel", def: "A mead made with rose petals or rose hips." },
  { term: "Sack Mead", def: "A very sweet, high-alcohol mead. Uses lots of honey." },
  { term: "Sanitize", def: "Cleaning equipment with a no-rinse sanitizer (Star San) to prevent contamination. THE #1 RULE OF BREWING." },
  { term: "Secondary Fermentation", def: "A calmer phase after primary, where mead clarifies and flavors develop." },
  { term: "Specific Gravity (SG)", def: "A measure of liquid density relative to water (1.000). Higher = more sugar." },
  { term: "Stabilize", def: "Adding potassium sorbate + campden tablets to prevent renewed fermentation." },
  { term: "Step Feeding", def: "Adding honey in stages rather than all at once, to manage yeast stress and hit high ABVs." },
  { term: "Stuck Fermentation", def: "When fermentation stops prematurely. Often caused by nutrient deficiency or temperature issues." },
  { term: "Tannin", def: "A compound that adds astringency/mouthfeel. Found in tea, oak, grape skins, and some fruits." },
  { term: "Terroir", def: "The environmental factors that affect the character of honey (and thus mead)." },
  { term: "Traditional Mead", def: "Also called 'Show Mead.' Made with only honey, water, and yeast." },
  { term: "YAN", def: "Yeast Assimilable Nitrogen â€” the total nitrogen available to yeast. Critical for healthy fermentation." },
];

// â”€â”€â”€ Compatibility Engine â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function getCompatibilityWarnings(rb) {
  const w = []; // { level: "error"|"warn"|"info"|"ok", icon, title, detail }
  const { sweetness, abv, honeyType, fruits, spices, extras, brewDays, liquid, yeastId } = rb;
  const abvTarget = ABV_RANGES.find(a => a.id === abv)?.target || 11;
  const honeyInfo = HONEY_TYPES.find(h => h.name === honeyType);
  const days = parseInt(brewDays) || 60;
  const totalAdditions = fruits.length + spices.length + extras.length;

  // Helper categories
  const hasCitrusFruit = fruits.some(f => ["Lemon", "Lime", "Grapefruit", "Orange"].includes(f));
  const hasTropicalFruit = fruits.some(f => ["Pineapple", "Mango", "Passionfruit", "Dragonfruit", "Coconut", "Banana"].includes(f));
  const hasBerryFruit = fruits.some(f => ["Blueberry", "Raspberry", "Blackberry", "Strawberry", "Elderberry", "Cranberry"].includes(f));
  const hasStoneFruit = fruits.some(f => ["Peach", "Apricot", "Plum", "Cherry"].includes(f));
  const hasDarkFruit = fruits.some(f => ["Cherry", "Blackberry", "Elderberry", "Fig", "Plum", "Pomegranate"].includes(f));
  const hasDelicateFruit = fruits.some(f => ["Strawberry", "Peach", "Apricot", "Dragonfruit"].includes(f));
  const hasTartFruit = fruits.some(f => ["Cranberry", "Lemon", "Lime", "Grapefruit", "Pomegranate"].includes(f));

  const hasDelicateFloral = spices.some(s => ["Lavender", "Chamomile", "Rose Petals", "Hibiscus"].includes(s));
  const hasWarmSpice = spices.some(s => ["Cinnamon", "Clove", "Nutmeg", "Allspice", "Star Anise", "Cardamom"].includes(s));
  const hasSavoryHerb = spices.some(s => ["Rosemary", "Thyme", "Sage", "Bay Leaf", "Basil"].includes(s));
  const hasBoldAdditive = spices.some(s => ["Coffee Beans", "Cocoa Nibs"].includes(s)) || extras.includes("caramelized");
  const hasOak = spices.includes("Oak Chips");

  const isJuiceBase = liquid && !["water", "custom"].includes(liquid);
  const isTartBase = ["cranberry-juice", "cherry-juice", "pomegranate-juice"].includes(liquid);
  const isFruityBase = ["apple-cider", "apple-juice", "grape-juice", "cherry-juice", "cranberry-juice", "pomegranate-juice"].includes(liquid);
  const isBoldBase = ["coffee", "tea"].includes(liquid);

  const selectedYeast = yeastId ? YEAST_DB.find(y => y.id === yeastId) : null;

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // SECTION 1: LIQUID â†” EVERYTHING
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  // Liquid â†” Fruit
  if (liquid === "apple-cider" && hasTropicalFruit) {
    w.push({ level: "warn", icon: "ğŸ", title: "Apple Cider + Tropical Fruits", detail: "Apple cider's earthy, tannic character clashes with bright tropicals. Use water for tropical melomels, or lean into apple with berries or stone fruits." });
  }
  if (liquid === "apple-cider" && fruits.includes("Orange")) {
    w.push({ level: "info", icon: "ğŸ", title: "Apple Cider + Orange", detail: "Can work but apple and orange compete rather than complement. Consider using one or the other as the star." });
  }
  if (liquid === "cherry-juice" && fruits.includes("Cherry")) {
    w.push({ level: "info", icon: "ğŸ’", title: "Cherry Juice + Cherry Fruit = Double Cherry", detail: "You'll get a very intense cherry character. Great if that's the goal â€” just know it'll dominate everything else." });
  }
  if (liquid === "cranberry-juice" && fruits.includes("Cranberry")) {
    w.push({ level: "info", icon: "ğŸ«", title: "Cranberry Juice + Cranberry Fruit", detail: "Extremely tart. Make sure your sweetness level can balance this, or it may be undrinkably sour." });
  }
  if (liquid === "grape-juice" && fruits.length > 1) {
    w.push({ level: "info", icon: "ğŸ‡", title: "Grape Juice Base + Multiple Fruits", detail: "Grape juice already has strong character. Additional fruits may get lost or create a muddy profile. 1 complementary fruit works better." });
  }
  if (liquid === "coconut-water" && hasSavoryHerb) {
    w.push({ level: "warn", icon: "ğŸ¥¥", title: "Coconut Water + Savory Herbs", detail: "Coconut's mild tropical character clashes with rosemary, thyme, and sage. Pair coconut with vanilla, cinnamon, or tropical fruits instead." });
  }

  // Liquid â†” Spice
  if (liquid === "coffee" && hasDelicateFloral) {
    w.push({ level: "warn", icon: "â˜•", title: "Coffee Base + Delicate Florals", detail: "Coffee's bold roast character will completely overpower lavender, chamomile, rose, or hibiscus. Use water for floral metheglins." });
  }
  if (liquid === "coffee" && hasDelicateFruit) {
    w.push({ level: "warn", icon: "â˜•", title: "Coffee Base + Delicate Fruits", detail: "Coffee will drown out strawberry, peach, apricot, and dragonfruit. Pair coffee base with dark fruits (cherry, blackberry) or chocolate/vanilla instead." });
  }
  if (liquid === "coffee" && spices.includes("Cocoa Nibs") && spices.includes("Vanilla Bean")) {
    w.push({ level: "ok", icon: "â˜•", title: "Coffee + Cocoa + Vanilla = Mocha Mead", detail: "A classic dessert-style combo. Consider semi-sweet or sweet to round out any bitterness." });
  }
  if (liquid === "tea" && hasBoldAdditive) {
    w.push({ level: "info", icon: "ğŸ«–", title: "Tea Base + Bold Additives", detail: "Tea's subtle tannin and flavor may get buried under coffee, cocoa, or caramelized honey. Tea works best with lighter additions â€” florals, citrus, or ginger." });
  }
  if (liquid === "tea" && spices.includes("Ginger")) {
    w.push({ level: "ok", icon: "ğŸ«–", title: "Tea + Ginger = Classic Combo", detail: "Tea and ginger are natural partners. Add lemon fruit or honey with citrus notes for a honey-ginger-tea mead." });
  }

  // Liquid â†” Honey
  if (liquid === "grape-juice" && honeyType === "Buckwheat") {
    w.push({ level: "warn", icon: "ğŸ‡", title: "Grape Juice + Buckwheat = Very Heavy", detail: "Both add strong, tannic flavors. The result may be overwhelmingly bold. Use a lighter honey for pyments." });
  }
  if (liquid === "coffee" && honeyType === "Buckwheat") {
    w.push({ level: "warn", icon: "â˜•", title: "Coffee + Buckwheat = Extremely Bold", detail: "Both are intensely flavored. This will be a very dark, heavy, aggressive mead. Dial back one or the other unless that's your goal." });
  }
  if (isFruityBase && honeyInfo?.intensity === "heavy") {
    w.push({ level: "info", icon: "ğŸ¯", title: `${honeyType} Honey + Juice Base`, detail: `${honeyType}'s bold flavor may compete with your ${LIQUID_BASES.find(l => l.id === liquid)?.name} base. Lighter honeys let juice character shine through.` });
  }

  // Liquid â†” ABV/Sweetness
  if (isTartBase && sweetness === "dry") {
    w.push({ level: "warn", icon: "âš ï¸", title: `${LIQUID_BASES.find(l => l.id === liquid)?.name} + Dry = Very Tart`, detail: "Tart juice bases need some residual sweetness to balance. Dry finish will make this bracingly sour. Consider semi-sweet at minimum." });
  }
  if (liquid === "coffee" && abv === "session") {
    w.push({ level: "info", icon: "â˜•", title: "Coffee + Session Strength", detail: "Coffee meads at low ABV can taste thin and bitter. Standard strength provides better body to carry the coffee." });
  }
  if (isFruityBase && abv === "strong") {
    w.push({ level: "info", icon: "ğŸ§ƒ", title: "Juice Base Adds Fermentable Sugar", detail: "Juice bases contain sugar that adds to your total fermentable load. Your actual ABV may come in higher than estimated. Consider reducing honey slightly or monitoring gravity closely." });
  }

  // Liquid â†” Special Additions
  if (liquid === "coffee" && extras.includes("caramelized")) {
    w.push({ level: "info", icon: "ğŸ«•", title: "Coffee + Bochet", detail: "Both are bold and dark. This can work as a decadent dessert mead, but the flavors may blur together. Add vanilla to help differentiate them." });
  }
  if (isFruityBase && extras.includes("malt")) {
    w.push({ level: "warn", icon: "ğŸº", title: "Juice Base + Malt (Braggot)", detail: "Braggots are already a honey-malt hybrid. Adding a juice base creates a three-way identity crisis. Pick juice OR malt, not both." });
  }

  // Liquid â†” Timeline
  if (isFruityBase && days < 60) {
    w.push({ level: "info", icon: "ğŸ§ƒ", title: "Juice Base Needs Settling Time", detail: "Juice bases can create more sediment and haze than water. Allow extra time for clearing â€” 60+ days recommended." });
  }

  // Preservative warning for all juice bases
  if (isJuiceBase) {
    w.push({ level: "info", icon: "ğŸ§ƒ", title: "Non-Water Base: Check for Preservatives", detail: "Make sure your liquid has NO potassium sorbate or sodium benzoate â€” these will prevent fermentation entirely. Check the label!" });
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // SECTION 2: FRUIT â†” SPICE/BOTANICAL
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  if (hasCitrusFruit && hasDelicateFloral) {
    w.push({ level: "warn", icon: "âš”ï¸", title: "Citrus Fruits vs. Delicate Florals", detail: "Strong citrus overpowers delicate florals like lavender and chamomile. Pick one direction â€” bright citrus OR soft floral." });
  }
  if (hasTropicalFruit && hasSavoryHerb) {
    w.push({ level: "warn", icon: "ğŸ¤”", title: "Tropical Fruits + Savory Herbs", detail: "Tropical sweetness (mango, banana, pineapple) clashes with savory herbs (rosemary, thyme, sage). These pull in opposite directions." });
  }
  if (hasDelicateFruit && hasBoldAdditive) {
    w.push({ level: "warn", icon: "ğŸ’ª", title: "Bold Additives Overpower Delicate Fruits", detail: "Coffee, cocoa, and caramelized honey dominate subtle fruits like strawberry and peach. Pair bold additions with dark, robust fruits instead." });
  }
  if (hasDarkFruit && hasOak) {
    w.push({ level: "ok", icon: "ğŸ‘Œ", title: "Dark Fruit + Oak", detail: "Oak adds tannin and complexity that complements dark fruits beautifully â€” wine-like elegance." });
  }
  if (hasDarkFruit && hasWarmSpice && !hasTropicalFruit) {
    w.push({ level: "ok", icon: "ğŸ‘Œ", title: "Dark Fruit + Warm Spices", detail: "Dark berries/stone fruits with cinnamon, clove, or allspice is a proven winter mead profile." });
  }
  if (hasBerryFruit && hasDelicateFloral && !hasCitrusFruit && !hasBoldAdditive) {
    w.push({ level: "ok", icon: "ğŸŒ¸", title: "Berries + Florals", detail: "Berry and floral combinations are classic mead pairings. Blueberry-lavender, raspberry-hibiscus, blackberry-rose â€” all great." });
  }
  if (spices.includes("Mint") && fruits.length > 2) {
    w.push({ level: "info", icon: "ğŸŒ¿", title: "Mint Dominates Fruit Blends", detail: "Mint is assertive and masks multiple fruits. Best with a single fruit (berry or citrus) rather than complex blends." });
  }
  if (spices.includes("Coffee Beans") && hasDelicateFruit) {
    w.push({ level: "warn", icon: "â˜•", title: "Coffee Overpowers Delicate Fruits", detail: "Coffee dominates light fruits. Pair with cherry, blackberry, or chocolate-adjacent flavors instead." });
  }
  if (fruits.includes("Coconut") && hasSavoryHerb) {
    w.push({ level: "warn", icon: "ğŸ¥¥", title: "Coconut + Savory Herbs", detail: "Coconut's tropical sweetness clashes with earthy herbs. Pair with vanilla, cinnamon, or tropical spices." });
  }

  // Specific great pairings (fruit â†” spice)
  if (fruits.includes("Cherry") && spices.includes("Vanilla Bean")) w.push({ level: "ok", icon: "ğŸ‘Œ", title: "Cherry + Vanilla", detail: "Classic. Vanilla rounds out cherry's tartness beautifully." });
  if (fruits.includes("Blueberry") && spices.includes("Lavender")) w.push({ level: "ok", icon: "ğŸ‘Œ", title: "Blueberry + Lavender", detail: "Natural match â€” lavender enhances blueberry's floral side." });
  if (fruits.includes("Peach") && spices.includes("Ginger")) w.push({ level: "ok", icon: "ğŸ‘Œ", title: "Peach + Ginger", detail: "Ginger's warmth lifts peach's sweetness. A crowd-pleaser." });
  if (fruits.includes("Raspberry") && spices.includes("Hibiscus")) w.push({ level: "ok", icon: "ğŸ‘Œ", title: "Raspberry + Hibiscus", detail: "Both tart and vibrant â€” hibiscus deepens raspberry's color and flavor." });
  if (spices.includes("Cocoa Nibs") && spices.includes("Vanilla Bean")) w.push({ level: "ok", icon: "ğŸ‘Œ", title: "Cocoa + Vanilla", detail: "Chocolate bar in mead form. A dessert lover's dream." });
  if (fruits.includes("Mango") && spices.includes("Black Pepper")) w.push({ level: "ok", icon: "ğŸ‘Œ", title: "Mango + Black Pepper", detail: "Surprising but well-known culinary pairing. Pepper brings out mango's depth." });
  if (fruits.includes("Pineapple") && spices.includes("Ginger") && !hasBoldAdditive) w.push({ level: "ok", icon: "ğŸ‘Œ", title: "Pineapple + Ginger", detail: "Tropical heat â€” natural partners." });
  if (fruits.includes("Blackberry") && spices.includes("Sage")) w.push({ level: "ok", icon: "ğŸ‘Œ", title: "Blackberry + Sage", detail: "An earthy, complex pairing. Sage complements blackberry's depth without overwhelming." });
  if (fruits.includes("Fig") && spices.includes("Cinnamon")) w.push({ level: "ok", icon: "ğŸ‘Œ", title: "Fig + Cinnamon", detail: "Rich, autumnal combination. Works especially well with semi-sweet or sweet meads." });
  if (fruits.includes("Cranberry") && spices.includes("Ginger")) w.push({ level: "ok", icon: "ğŸ‘Œ", title: "Cranberry + Ginger", detail: "Tart meets spicy â€” ginger's warmth balances cranberry's bite. Great winter mead." });
  if (fruits.includes("Orange") && spices.includes("Cinnamon") && spices.includes("Clove")) w.push({ level: "ok", icon: "ğŸ‘Œ", title: "Orange + Cinnamon + Clove = Mulled Mead", detail: "A classic mulled wine flavor profile. Works beautifully." });

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // SECTION 3: HONEY â†” EVERYTHING
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  if (honeyInfo?.intensity === "heavy" && hasDelicateFruit) {
    const delicate = fruits.filter(f => ["Strawberry", "Peach", "Apricot", "Dragonfruit", "Coconut"].includes(f));
    if (delicate.length) w.push({ level: "warn", icon: "ğŸ¯", title: `${honeyType} May Overpower ${delicate.join(", ")}`, detail: `${honeyType} has a very bold flavor. Use Clover or Orange Blossom to let delicate fruits shine.` });
  }
  if (honeyInfo?.intensity === "heavy" && hasDelicateFloral) {
    w.push({ level: "warn", icon: "ğŸ¯", title: `${honeyType} Overwhelms Delicate Florals`, detail: `${honeyType}'s intense flavor will mask lavender, chamomile, rose, or hibiscus. Use a lighter honey for floral metheglins.` });
  }
  if (honeyType === "Meadowfoam" && spices.includes("Vanilla Bean")) {
    w.push({ level: "info", icon: "ğŸ¯", title: "Double Vanilla â€” Intentional?", detail: "Meadowfoam already has vanilla/marshmallow character. Adding vanilla bean doubles down â€” great if you want a vanilla bomb." });
  }
  if (honeyType === "Orange Blossom" && (fruits.includes("Orange") || hasCitrusFruit)) {
    w.push({ level: "info", icon: "ğŸŠ", title: "Citrus Honey + Citrus Fruit", detail: "Orange Blossom honey already has citrus notes. Adding citrus fruit goes all-in on that character â€” works great if intentional." });
  }
  if (honeyType === "Mesquite" && hasTropicalFruit) {
    w.push({ level: "warn", icon: "ğŸ¯", title: "Mesquite + Tropical Fruits", detail: "Mesquite's earthy, smoky character fights with bright tropical flavors. This pairing rarely works well." });
  }
  if (honeyType === "Buckwheat" && extras.includes("caramelized")) {
    w.push({ level: "warn", icon: "ğŸ¯", title: "Buckwheat + Bochet = Extremely Dark", detail: "Buckwheat is already bold and molasses-like. Caramelizing it pushes it to extreme intensity. Use a lighter honey for bochets unless you want something very aggressive." });
  }
  if (honeyInfo?.intensity === "light" && hasBoldAdditive) {
    w.push({ level: "info", icon: "ğŸ¯", title: `${honeyType} May Get Lost`, detail: `${honeyType}'s mild flavor may be completely hidden by coffee, cocoa, or caramelized honey. Consider Wildflower or Buckwheat for bold additions.` });
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // SECTION 4: SPECIAL ADDITIONS â†” EVERYTHING
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  if (extras.includes("caramelized") && hasDelicateFloral) {
    w.push({ level: "warn", icon: "ğŸ«•", title: "Bochet Overpowers Florals", detail: "Caramelized honey's intense toffee/burnt sugar dominates anything subtle. Pair with bold flavors or let bochet speak alone." });
  }
  if (extras.includes("caramelized") && hasDelicateFruit) {
    w.push({ level: "warn", icon: "ğŸ«•", title: "Bochet Overpowers Delicate Fruits", detail: "Caramelized honey will drown out strawberry, peach, etc. Pair with dark fruits (cherry, fig, blackberry) for bochets." });
  }
  if (extras.includes("caramelized") && hasDarkFruit) {
    w.push({ level: "ok", icon: "ğŸ«•", title: "Bochet + Dark Fruits", detail: "Dark fruits hold up to caramelized honey's intensity. Cherry bochet and fig bochet are particularly well-regarded." });
  }
  if (extras.includes("caramelized") && spices.includes("Vanilla Bean")) {
    w.push({ level: "ok", icon: "ğŸ«•", title: "Bochet + Vanilla", detail: "Vanilla and toffee/caramel are natural partners. This is a dessert mead classic." });
  }
  if (extras.includes("malt") && fruits.length > 2) {
    w.push({ level: "info", icon: "ğŸº", title: "Braggot + Many Fruits", detail: "Braggots blend mead and beer. Many fruits on top creates an identity crisis. Keep fruit to 1â€“2 max." });
  }
  if (extras.includes("malt") && hasDelicateFloral) {
    w.push({ level: "warn", icon: "ğŸº", title: "Braggot + Florals", detail: "Malt's grain character clashes with delicate florals. Braggots work better with warm spices (cinnamon, ginger) or bold additions." });
  }
  if (extras.includes("malt") && spices.includes("Ginger")) {
    w.push({ level: "ok", icon: "ğŸº", title: "Braggot + Ginger", detail: "Ginger beer meets mead â€” a well-established combination with great character." });
  }
  if (extras.includes("maple") && honeyType === "Buckwheat") {
    w.push({ level: "warn", icon: "ğŸ", title: "Maple + Buckwheat = Very Heavy", detail: "Both bold and dark. Combined, it may be overwhelmingly heavy. Use a lighter honey to let maple speak." });
  }
  if (extras.includes("maple") && hasWarmSpice) {
    w.push({ level: "ok", icon: "ğŸ", title: "Maple + Warm Spices", detail: "Maple with cinnamon, nutmeg, or allspice is a fantastic autumn mead profile. Like liquid pancakes." });
  }
  if (extras.includes("maple") && hasTropicalFruit) {
    w.push({ level: "warn", icon: "ğŸ", title: "Maple + Tropical Fruits", detail: "Maple's earthy sweetness doesn't pair well with bright tropical flavors. Maple works better with berries, apples, or warm spices." });
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // SECTION 5: SPICE â†” SPICE INTERACTIONS
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  if (spices.includes("Lemongrass") && hasWarmSpice) {
    w.push({ level: "warn", icon: "ğŸŒ¿", title: "Lemongrass + Warm Spices", detail: "Lemongrass pushes toward bright, Thai-inspired flavors while cinnamon/clove/nutmeg go warm and autumnal. These pull in opposite directions. Pick a lane." });
  }
  if (spices.includes("Coffee Beans") && spices.includes("Tea (Earl Grey)")) {
    w.push({ level: "warn", icon: "â˜•", title: "Coffee + Tea: Competing Caffeine", detail: "Both are bold and tannic but in different directions. Coffee will dominate, making the tea pointless. Pick one." });
  }
  if (hasSavoryHerb && hasDelicateFloral) {
    w.push({ level: "info", icon: "ğŸŒ¿", title: "Savory Herbs + Delicate Florals", detail: "Rosemary/thyme/sage can overshadow lavender/chamomile. If using both, go heavier on florals and lighter on herbs." });
  }
  if (spices.includes("Saffron") && (totalAdditions > 3)) {
    w.push({ level: "info", icon: "ğŸŒ¾", title: "Saffron is Subtle and Expensive", detail: "Saffron's delicate flavor is easily buried. Keep the recipe simple â€” ideally saffron with just light honey and maybe one complementary addition." });
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // SECTION 6: ABV â†” SWEETNESS â†” INGREDIENTS
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  if (abv === "session" && sweetness === "very-sweet") {
    w.push({ level: "error", icon: "âš ï¸", title: "Incompatible: Low ABV + Very Sweet", detail: "Yeast would need to stop extremely early. Nearly impossible to control. Choose Semi-Sweet max for hydromel, or increase ABV." });
  }
  if (abv === "session" && sweetness === "sweet") {
    w.push({ level: "warn", icon: "âš ï¸", title: "Tricky: Low ABV + Sweet", detail: "Requires careful yeast management and back-sweetening. Not beginner-friendly. Consider Semi-Sweet." });
  }
  if (abv === "strong" && sweetness === "dry") {
    w.push({ level: "info", icon: "ğŸ’ª", title: "Dry + Strong = Hot Alcohol", detail: "High ABV dry meads taste 'hot' without sweetness to balance. Needs 6â€“12+ months aging." });
  }
  if (hasTartFruit && sweetness === "dry" && !isTartBase) {
    w.push({ level: "info", icon: "ğŸ‹", title: "Tart Fruit + Dry Finish", detail: "Cranberry, citrus, and pomegranate are naturally tart. A dry finish amplifies that â€” consider semi-sweet for better balance." });
  }
  if (totalAdditions >= 6 && abv === "session") {
    w.push({ level: "warn", icon: "ğŸ“Š", title: "Many Additions + Low ABV", detail: "Session meads have light body that may not support this many additions. Strong flavors need alcohol to carry them." });
  }
  if (abv === "strong" && hasTropicalFruit) {
    w.push({ level: "info", icon: "ğŸŒ´", title: "Tropical Fruits + High ABV", detail: "Delicate tropical fruit flavors can get masked by high alcohol. Standard ABV often showcases tropicals better. If going strong, add fruit generously in secondary." });
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // SECTION 7: TIMELINE â†” EVERYTHING
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  if (abv === "strong" && days < 90) {
    w.push({ level: "error", icon: "â°", title: "Timeline Too Short for High ABV", detail: `${days} days isn't enough for 14â€“18% ABV. Fermentation alone takes 4â€“6 weeks, plus aging. Need 120+ days, ideally 180+.` });
  }
  if (abv === "standard" && days < 45) {
    w.push({ level: "warn", icon: "â°", title: "Very Tight Timeline", detail: `${days} days is cutting it close for standard mead. Consider 60+ days.` });
  }
  if (days > 300 && abv === "session") {
    w.push({ level: "info", icon: "â°", title: "Long Aging for Session Mead", detail: "Session meads are best fresh at 30â€“60 days. Extended aging may cause light flavors to fade." });
  }
  if (fruits.length > 0 && days < 45) {
    w.push({ level: "warn", icon: "ğŸ‡", title: "Fruit Needs Time in Secondary", detail: "Fruit needs 2â€“4 weeks in secondary for proper extraction. Your timeline may not allow full fruit expression." });
  }
  if (spices.length > 0 && days < 35) {
    w.push({ level: "warn", icon: "ğŸŒ¿", title: "Spices Need Infusion Time", detail: "Spices need at least 1â€“2 weeks to properly infuse. Very short timelines won't give you full spice character." });
  }
  if (extras.includes("caramelized") && days < 90) {
    w.push({ level: "warn", icon: "ğŸ«•", title: "Bochets Need Aging", detail: "Caramelized honey produces intense flavors that need time to mellow and integrate. 90+ days minimum, 6 months ideal." });
  }
  if (hasOak && days < 60) {
    w.push({ level: "warn", icon: "ğŸªµ", title: "Oak Needs Time", detail: "Oak chips need 4â€“8 weeks to impart proper flavor. Too little time = raw, tannic character. Too much = over-oaked." });
  }
  if (abv === "strong" && sweetness === "dry" && days < 180) {
    w.push({ level: "warn", icon: "â°", title: "Dry Strong Mead Needs Extended Aging", detail: "High ABV dry meads are harsh when young. They really need 6+ months to become enjoyable. Consider extending your timeline." });
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // SECTION 8: YEAST â†” RECIPE (when user has chosen a yeast)
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  if (selectedYeast) {
    if (selectedYeast.tolerance < abvTarget) {
      w.push({ level: "warn", icon: "ğŸ§«", title: `${selectedYeast.name} Tolerance (${selectedYeast.tolerance}%) < Target ABV (~${abvTarget}%)`, detail: "This yeast may stop fermenting before reaching your target, leaving residual sweetness. That may be fine if you want a sweeter mead, but it won't be fully dry." });
    }
    if (selectedYeast.id === "d47" && fruits.length > 0 && !hasDarkFruit) {
      w.push({ level: "info", icon: "ğŸ§«", title: "D-47 Isn't Ideal for Fruit Meads", detail: "D-47 is great for traditionals and spiced meads but can produce harsh flavors with fruit. 71B metabolizes malic acid, making it better for melomels." });
    }
    if (selectedYeast.id === "ec1118" && (hasDelicateFruit || hasDelicateFloral)) {
      w.push({ level: "warn", icon: "ğŸ§«", title: "EC-1118 Strips Delicate Flavors", detail: "EC-1118 ferments very aggressively and can strip out subtle fruit and floral character. Consider 71B or QA23 for delicate additions." });
    }
    if (selectedYeast.id === "us05" && abvTarget > 11) {
      w.push({ level: "warn", icon: "ğŸ§«", title: "US-05 May Stall at High ABV", detail: "Safale US-05 is an ale yeast with 11% tolerance. For standard or strong meads, use a wine yeast like 71B, K1-V1116, or EC-1118." });
    }
    if (selectedYeast.id === "rc212" && !hasDarkFruit) {
      w.push({ level: "info", icon: "ğŸ§«", title: "RC-212 Shines with Dark Fruits", detail: "RC-212 enhances red/dark fruit character. Without dark fruits in your recipe, other yeasts may serve you better." });
    }
    if (selectedYeast.id === "71b" && extras.includes("malt")) {
      w.push({ level: "info", icon: "ğŸ§«", title: "71B Not Typical for Braggots", detail: "71B is a wine yeast optimized for fruit. For braggots, US-05 or a beer yeast may give more authentic character." });
    }
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // SECTION 9: SPECIFIC INGREDIENT WARNINGS (always show)
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  if (spices.includes("Clove")) {
    w.push({ level: "info", icon: "ğŸ«š", title: "Clove â€” Use Sparingly!", detail: "Clove is extremely potent. 1â€“2 cloves per gallon max. Add in secondary so you can taste and remove." });
  }
  if (spices.includes("Star Anise") && !["sweet", "very-sweet"].includes(sweetness)) {
    w.push({ level: "info", icon: "â­", title: "Star Anise in Dry Mead", detail: "Star anise's licorice flavor can taste medicinal without sweetness to balance. Consider semi-sweet or sweet." });
  }
  if (fruits.includes("Banana")) {
    w.push({ level: "info", icon: "ğŸŒ", title: "Banana â€” Processing Matters", detail: "Banana creates pectin haze. Use pectic enzyme. Overripe bananas work best for flavor." });
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // SECTION 10: VOLUME WARNINGS
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  if (fruits.length > 4) {
    w.push({ level: "warn", icon: "ğŸ¨", title: `${fruits.length} Fruits â€” Muddling Risk`, detail: "More than 4 fruits creates a muddy, indistinct flavor. Feature 1â€“2 stars with maybe 1 supporting fruit." });
  } else if (fruits.length >= 3) {
    w.push({ level: "info", icon: "ğŸ¹", title: `${fruits.length} Fruits Selected`, detail: "Works best if they're in the same family (all berries, all tropical, all stone fruit)." });
  }
  if (spices.length > 4) {
    w.push({ level: "warn", icon: "ğŸŒ¶ï¸", title: `${spices.length} Spices â€” Overload`, detail: "Too many spices = spice cabinet. Narrow to 2â€“3 with a cohesive theme (e.g., chai: cinnamon + cardamom + ginger)." });
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // SECTION 11: POSITIVE OVERALL ASSESSMENT
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  if (totalAdditions === 0 && honeyInfo?.intensity !== "heavy" && liquid === "water") {
    w.push({ level: "ok", icon: "ğŸ¯", title: "Clean Traditional â€” Great Choice", detail: "Lets the honey shine. One of the best ways to learn the craft." });
  }
  if (totalAdditions === 0 && isFruityBase) {
    w.push({ level: "ok", icon: "ğŸ§ƒ", title: `${LIQUID_BASES.find(l => l.id === liquid)?.name} + Honey â€” Simple & Effective`, detail: "Juice-based meads with no extra additions can be fantastic. The juice and honey do all the work." });
  }

  return w;
}

// â”€â”€â”€ Utility Functions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function classifyMead(fruits, spices, extras) {
  const hasFruit = fruits && fruits.length > 0;
  const hasSpice = spices && spices.length > 0;
  const hasApple = fruits?.some(f => f.toLowerCase().includes("apple"));
  const hasGrape = fruits?.some(f => f.toLowerCase().includes("grape"));
  const hasPepper = spices?.some(s => s.toLowerCase().includes("pepper") || s.toLowerCase().includes("chili") || s.toLowerCase().includes("habanero") || s.toLowerCase().includes("jalapeÃ±o"));
  const hasMalt = extras?.includes("malt");
  const hasMaple = extras?.includes("maple");
  const hasRose = spices?.some(s => s.toLowerCase().includes("rose"));
  const hasCaramelized = extras?.includes("caramelized");

  if (hasCaramelized) return MEAD_TYPES.bochet;
  if (hasMalt) return MEAD_TYPES.braggot;
  if (hasMaple) return MEAD_TYPES.acerglyn;
  if (hasRose && !hasFruit) return MEAD_TYPES.rhodomel;
  if (hasPepper && !hasFruit) return MEAD_TYPES.capsicumel;
  if (hasApple) return MEAD_TYPES.cyser;
  if (hasGrape) return MEAD_TYPES.pyment;
  if (hasFruit && hasSpice) return MEAD_TYPES.melomelMetheglin;
  if (hasFruit) return MEAD_TYPES.melomel;
  if (hasSpice) return MEAD_TYPES.metheglin;
  return MEAD_TYPES.traditional;
}

function recommendYeast(targetABV, sweetness, fruits, spices, extras, liquid) {
  const hasFruit = fruits && fruits.length > 0;
  const hasDarkFruit = fruits?.some(f => ["Cherry", "Blackberry", "Elderberry", "Fig", "Plum", "Pomegranate"].includes(f));
  const hasMalt = extras?.includes("malt");
  const hasDelicateFloral = spices?.some(s => ["Lavender", "Chamomile", "Rose Petals", "Hibiscus"].includes(s));
  const isCoffeeBase = liquid === "coffee";
  const isCiderBase = liquid === "apple-cider" || liquid === "apple-juice";
  const candidates = YEAST_DB.filter(y => y.tolerance >= targetABV * 0.85);
  if (candidates.length === 0) return YEAST_DB.find(y => y.id === "ec1118");
  const find = (id) => candidates.find(y => y.id === id);

  // Braggots: prefer ale yeast
  if (hasMalt) {
    const pick = find("us05");
    if (pick) return pick;
  }
  // Dark fruit melomels: RC-212 is ideal
  if (hasDarkFruit && !hasMalt) {
    const pick = find("rc212") || find("71b");
    if (pick) return pick;
  }
  // Fruit meads: 71B metabolizes malic acid, best for melomels
  if (hasFruit) {
    const pick = find("71b") || find("qa23");
    if (pick) return pick;
  }
  // Cider base (cyser): 71B great for apple malic acid
  if (isCiderBase) {
    const pick = find("71b") || find("d47");
    if (pick) return pick;
  }
  // Coffee base: needs a clean fermenter that won't add competing flavors
  if (isCoffeeBase) {
    const pick = find("k1v") || find("ec1118");
    if (pick) return pick;
  }
  // Delicate florals: D-47 enhances floral character
  if (hasDelicateFloral && !hasFruit) {
    const pick = find("d47") || find("qa23");
    if (pick) return pick;
  }
  // Dry traditionals: D-47 for floral/spicy character
  if (sweetness === "dry" && targetABV <= 14) {
    const pick = find("d47") || find("qa23");
    if (pick) return pick;
  }
  // High ABV: need a strong fermenter
  if (targetABV > 14) {
    const pick = find("k1v") || find("ec1118");
    if (pick) return pick;
  }
  // Session/hydromel
  if (targetABV <= 7) {
    const pick = find("us05") || find("71b");
    if (pick) return pick;
  }
  return find("71b") || candidates[0];
}

function calcHoney(targetABV, sweetness, gallons) {
  const sw = SWEETNESS_LEVELS.find(s => s.id === sweetness);
  const gravityPoints = (targetABV / 131.25 * 1000) + (sw ? sw.ogAdjust * 1000 : 0);
  const og = 1 + gravityPoints / 1000;
  const lbsPerGallon = gravityPoints / 35;
  const totalLbs = lbsPerGallon * gallons;
  return { og: og.toFixed(3), lbs: totalLbs.toFixed(1), lbsPerGallon: lbsPerGallon.toFixed(1) };
}

function generateSchedule(brewDays, targetABV, sweetness, fruitTiming, spiceTiming, hasFruit, hasSpice, brewMethod, skill) {
  const totalDays = parseInt(brewDays) || 60;
  const isStrong = targetABV > 14;
  const isSession = targetABV <= 7;
  const schedule = [];
  const simple = brewMethod === "simple";
  const n = skill === "novice";
  const a = skill === "advanced";

  // â”€â”€â”€ BREW DAY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const brewDayTasks = [];
  if (simple) {
    brewDayTasks.push(
      n ? "Clean and sanitize ALL equipment (anything that touches your mead â€” use Star San or similar no-rinse sanitizer)" : a ? "Sanitize all equipment" : "Sanitize all equipment (Star San recommended)",
      n ? "Warm your liquid to about 100Â°F â€” warm enough to dissolve honey easily, but NOT boiling (boiling ruins honey's flavor and aroma)" : a ? "Warm liquid to ~100Â°F, dissolve honey" : "Warm liquid to ~100Â°F to help dissolve honey (don't boil)",
      n ? "Pour your honey into the warm liquid and stir until fully dissolved â€” this mixture is called the \"must\"" : a ? "Create must, stir to dissolve" : "Mix honey into liquid to create your must",
      n ? "If you have a hydrometer, take a reading now and write it down â€” this is your Original Gravity (OG) and tells you how much sugar is available for the yeast" : a ? "Record OG" : "Take a hydrometer reading (Original Gravity) and record it",
      n ? "Let the must cool to room temperature (65-75Â°F) â€” hot liquid will kill your yeast!" : a ? "Cool must to 65-75Â°F" : "Cool must to room temperature (65-75Â°F)",
      n ? "Add all your yeast nutrient at once (follow the package directions for amount)" : a ? "Add full nutrient dose" : "Add your yeast nutrient (full dose per package instructions)",
    );
    if (hasFruit && fruitTiming === "primary") brewDayTasks.push(n ? "Put your fruit in a sanitized mesh bag and add it to the fermenter" : "Add fruit in sanitized mesh bag");
    if (hasSpice && spiceTiming === "primary") brewDayTasks.push(n ? "Add your spices (whole spices in a mesh bag so you can remove them later)" : "Add spices (whole in mesh bag for easy removal)");
    brewDayTasks.push(
      n ? "Sprinkle your yeast directly on top of the must â€” no need to stir it in, it'll wake up on its own" : a ? "Sprinkle yeast on must surface" : "Sprinkle yeast on top of the must",
      n ? "Put the lid on your fermenter and fill the airlock with sanitizer water â€” the airlock lets gas escape without letting air or bugs in" : a ? "Seal with airlock" : "Seal fermenter and install airlock filled with sanitizer",
    );
  } else {
    // TECHNICAL
    brewDayTasks.push(
      n ? "Clean and sanitize ALL equipment (anything that touches your mead â€” use Star San or similar no-rinse sanitizer)" : a ? "Sanitize all equipment" : "Sanitize all equipment (Star San recommended)",
      n ? "Warm your liquid to about 100Â°F â€” warm enough to dissolve honey easily, but NOT boiling" : a ? "Warm liquid to ~100Â°F, dissolve honey" : "Warm liquid to ~100Â°F to dissolve honey (don't boil)",
      n ? "Pour your honey into the warm liquid and stir until fully dissolved â€” this is your \"must\"" : a ? "Create must" : "Mix honey into liquid to create must",
      n ? "Take a hydrometer reading (Original Gravity / OG) and write it down" : a ? "Record OG" : "Take and record OG reading",
      n ? "Let the must cool to 65-75Â°F" : a ? "Cool to 65-75Â°F" : "Cool must to 65-75Â°F",
      n ? "While cooling, prepare your yeast: dissolve Go-Ferm in warm water (104Â°F), then sprinkle yeast into it. This \"rehydration\" wakes the yeast up gently and makes them healthier." : a ? "Rehydrate yeast in Go-Ferm solution (104Â°F)" : "Rehydrate yeast: dissolve Go-Ferm in 104Â°F water, sprinkle yeast in, wait 15 min",
    );
    if (hasFruit && fruitTiming === "primary") brewDayTasks.push(n ? "Put fruit in a sanitized mesh bag and add to fermenter" : "Add fruit in sanitized mesh bag");
    if (hasSpice && spiceTiming === "primary") brewDayTasks.push(n ? "Add spices (whole spices in mesh bag for easy removal)" : "Add spices in mesh bag");
    brewDayTasks.push(
      n ? "When must is at temperature, gently pour in your rehydrated yeast" : a ? "Pitch rehydrated yeast" : "Pitch rehydrated yeast into cooled must",
      n ? "Seal fermenter and install airlock filled with sanitizer" : a ? "Seal with airlock" : "Seal fermenter, install airlock",
    );
  }
  schedule.push({ day: 0, label: "Brew Day", tasks: brewDayTasks, phase: "prep" });

  // â”€â”€â”€ PRIMARY FERMENTATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  if (simple) {
    schedule.push({ day: 3, label: n ? "Day 3 â€” Quick Check" : "Day 3 â€” Fermentation Check", tasks: [
      n ? "Look at your airlock â€” you should see bubbles! That means the yeast is working. No bubbles? Give it another day." : a ? "Verify airlock activity" : "Check for fermentation activity (bubbles in airlock)",
      n ? "Give the fermenter a gentle swirl to help release gas bubbles trapped in the liquid" : a ? "Gentle swirl to degas" : "Gently swirl fermenter to release trapped COâ‚‚",
    ], phase: "primary" });
    schedule.push({ day: 7, label: n ? "Day 7 â€” One Week Check" : "Day 7 â€” Progress Check", tasks: [
      n ? "Swirl gently again to release gas" : a ? "Degas" : "Swirl to degas",
      n ? "If you have a hydrometer, take a reading to see how things are progressing" : a ? "Optional gravity reading" : "Take a gravity reading if you have a hydrometer",
      ...(hasFruit && fruitTiming === "primary" ? [n ? "Taste a tiny sample â€” is the fruit flavor coming through?" : "Check fruit flavor extraction"] : []),
    ], phase: "primary" });
  } else {
    // TECHNICAL â€” staggered nutrients + degassing
    schedule.push({ day: 1, label: n ? "Day 1 â€” First Feeding" : a ? "Day 1 â€” SNA #1" : "Day 1 â€” First Nutrient Addition", tasks: [
      n ? "Stir or swirl your mead vigorously for 1-2 minutes to release COâ‚‚ gas (called \"degassing\")" : a ? "Degas vigorously" : "Degas by stirring/swirling vigorously",
      n ? "Add your first nutrient dose â€” this feeds the yeast and helps them stay healthy (use Fermaid-O if you have it)" : a ? "Add SNA dose #1 (Fermaid-O)" : "Add first nutrient dose (Fermaid-O recommended)",
      n ? "Check for signs of fermentation â€” bubbles, foam on top, or hissing sounds" : a ? "Confirm fermentation activity" : "Check for fermentation activity (bubbles, foam)",
    ], phase: "primary" });
    schedule.push({ day: 2, label: n ? "Day 2 â€” Stir to Release Gas" : a ? "Day 2 â€” Degas" : "Day 2 â€” Degassing", tasks: [
      n ? "Stir or swirl vigorously to release gas (this helps the yeast breathe better)" : a ? "Degas" : "Degas by stirring",
      n ? "Check that airlock is still bubbling" : a ? "Check airlock" : "Check airlock activity",
    ], phase: "primary" });
    schedule.push({ day: 3, label: n ? "Day 3 â€” Second Feeding" : a ? "Day 3 â€” SNA #2" : "Day 3 â€” Second Nutrient Addition", tasks: [
      n ? "Stir to release gas again" : a ? "Degas" : "Degas",
      n ? "Add your second nutrient dose" : a ? "Add SNA dose #2" : "Add second nutrient dose",
    ], phase: "primary" });
    schedule.push({ day: 5, label: n ? "Day 5 â€” Third Feeding" : a ? "Day 5 â€” SNA #3" : "Day 5 â€” Third Nutrient Addition", tasks: [
      n ? "Stir to release gas" : a ? "Degas" : "Degas",
      n ? "Add your third nutrient dose" : a ? "Add SNA dose #3" : "Add third nutrient dose",
    ], phase: "primary" });
    schedule.push({ day: 7, label: n ? "Day 7 â€” Last Feeding (1/3 Sugar Break)" : a ? "Day 7 â€” SNA #4 (1/3 break)" : "Day 7 â€” Final Nutrient (1/3 Sugar Break)", tasks: [
      n ? "Take a gravity reading â€” if it's dropped about 1/3 from your starting number (OG), it's time for the last nutrient dose" : a ? "Confirm 1/3 sugar break, add final SNA" : "Take gravity reading â€” if gravity dropped ~1/3 from OG, add final nutrient",
      n ? "Add your last nutrient dose â€” no more after this!" : a ? "Final SNA dose" : "This is the LAST nutrient addition",
      n ? "Keep stirring daily to release gas" : a ? "Continue daily degassing" : "Continue degassing daily",
    ], phase: "primary" });
    schedule.push({ day: 14, label: n ? "Day 14 â€” Two Week Check" : a ? "Day 14 â€” Gravity check" : "Day 14 â€” Gravity Check", tasks: [
      n ? "Take a gravity reading â€” fermentation should be slowing down now" : a ? "Gravity reading â€” fermentation slowing" : "Take gravity reading â€” fermentation should be slowing",
      n ? "STOP stirring from now on â€” oxygen is now your enemy and will make the mead taste stale" : a ? "Cease degassing â€” minimize Oâ‚‚ exposure" : "Stop degassing â€” minimize oxygen exposure from here on",
      ...(hasFruit && fruitTiming === "primary" ? [n ? "Taste the mead â€” if the fruit flavor is where you want it, you can remove the fruit bag" : "Consider removing fruit if flavor is sufficient"] : []),
    ], phase: "primary" });
  }

  // â”€â”€â”€ END PRIMARY / RACK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const primaryEnd = simple ? (isSession ? 14 : isStrong ? 28 : 21) : (isSession ? 14 : isStrong ? 28 : 21);
  if (primaryEnd > 14) {
    schedule.push({ day: primaryEnd, label: n ? `Day ${primaryEnd} â€” Ready to Transfer` : a ? `Day ${primaryEnd} â€” End primary` : `Day ${primaryEnd} â€” End of Primary`, tasks: [
      n ? "Take a gravity reading â€” it should be close to where you want it to finish" : a ? "Confirm near-terminal gravity" : "Take gravity reading (should be near target FG)",
      n ? "If the reading is the same two days in a row, the yeast is done eating sugar and it's time to transfer" : a ? "Verify stable gravity over 2-3 days" : "If gravity is stable for 2â€“3 days, ready to rack",
      n ? "Sanitize a second container (carboy or jug) for the transfer" : a ? "Sanitize secondary vessel" : "Prepare and sanitize secondary vessel",
      ...(hasFruit && fruitTiming === "primary" ? [n ? "Remove your fruit bag before transferring" : "Remove fruit bag"] : []),
      ...(hasSpice && spiceTiming === "primary" ? [n ? "Taste and decide if you want to remove the spices â€” they've been steeping for weeks" : "Evaluate spice extraction, remove if desired"] : []),
    ], phase: "primary" });
  }

  const rackDay = primaryEnd + 2;
  const rackTasks = [
    n ? "Use a siphon to gently transfer your mead to the clean container, leaving the sludge (called \"lees\") behind on the bottom â€” this is called \"racking\"" : a ? "Rack off lees to secondary" : "Rack mead off lees into clean, sanitized vessel (siphon gently)",
    n ? "Try not to splash â€” the mead doesn't want oxygen anymore" : a ? "Minimize Oâ‚‚ exposure" : "Minimize splashing to avoid oxidation",
    n ? "Top up the airlock with fresh sanitizer" : a ? "Airlock" : "Top up airlock",
  ];
  if (hasFruit && fruitTiming === "secondary") rackTasks.push(n ? "Now add your fruit! Put it in a sanitized mesh bag. Pro tip: freeze the fruit first, then thaw â€” this breaks the cell walls and gives you better flavor extraction." : a ? "Add fruit (frozen/thawed, in mesh bag)" : "Add fruit in sanitized mesh bag (freeze first to break cell walls)");
  if (hasSpice && spiceTiming === "secondary") rackTasks.push(n ? "Add your spices now â€” taste every few days and remove them when the flavor is where you like it" : a ? "Add spices â€” taste and pull when dialed in" : "Add spices â€” taste every few days and remove when flavor is right");
  if (sweetness !== "dry") rackTasks.push(n ? "If you want it sweet: add potassium sorbate AND a Campden tablet now to stop the yeast, wait 24 hours, then add honey to taste (this is called \"stabilizing\" and \"back-sweetening\")" : a ? "If back-sweetening: stabilize (K-sorb + K-meta), wait 24h, sweeten" : "If back-sweetening: stabilize with potassium sorbate + Campden tablet first, then sweeten after 24h");
  schedule.push({ day: rackDay, label: n ? `Day ${rackDay} â€” Transfer to Secondary` : a ? `Day ${rackDay} â€” Rack to secondary` : `Day ${rackDay} â€” Rack to Secondary`, tasks: rackTasks, phase: "secondary" });

  // â”€â”€â”€ BULK AGING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const bulkAgingStart = rackDay + 14;
  if (bulkAgingStart < totalDays) {
    const baTasks = [
      n ? "Check if your mead is getting clearer â€” you should be able to see through it more each week" : a ? "Assess clarity" : "Check if mead is clearing",
      n ? "If it's still cloudy, you can add a \"fining agent\" like bentonite (a type of clay) that grabs the haze particles and pulls them to the bottom" : a ? "Fine if needed (bentonite, gelatin)" : "If hazy, consider fining agent (bentonite or gelatin)",
      n ? "Take a gravity reading to make sure fermentation is truly done" : a ? "Confirm terminal gravity" : "Take gravity reading to confirm fermentation is complete",
      n ? "Take a small taste! Write down what you notice â€” any weird flavors will often fade with time" : a ? "Taste, note off-flavors (will age out)" : "Taste test â€” note any off-flavors that may age out",
    ];
    if (hasFruit && fruitTiming === "secondary") baTasks.push(n ? "Check the fruit flavor â€” if it's strong enough, remove the bag. Usually 2-4 weeks is enough." : a ? "Evaluate fruit, pull bag if done (typ. 2-4 wk)" : "Check fruit flavor â€” remove bag if extracted enough (typically 2â€“4 weeks)");
    if (hasSpice && spiceTiming === "secondary") baTasks.push(n ? "Check your spice intensity â€” remove them if the flavor is where you want it" : a ? "Evaluate spice, pull if done" : "Check spice intensity â€” remove if flavor is right");
    schedule.push({ day: bulkAgingStart, label: n ? `Day ${bulkAgingStart} â€” Checkup` : a ? `Day ${bulkAgingStart} â€” Clarity check` : `Day ${bulkAgingStart} â€” Check Clarity`, tasks: baTasks, phase: "secondary" });
  }

  // â”€â”€â”€ PRE-BOTTLING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const preBotDay = Math.max(totalDays - 7, bulkAgingStart + 7);
  if (preBotDay < totalDays && preBotDay > bulkAgingStart) {
    schedule.push({ day: preBotDay, label: n ? `Day ${preBotDay} â€” Getting Ready to Bottle` : a ? `Day ${preBotDay} â€” Pre-bottling` : `Day ${preBotDay} â€” Pre-Bottling`, tasks: [
      n ? "Take two gravity readings a few days apart â€” if they're the same number, fermentation is definitely done" : a ? "Confirm stable FG (same over 3 days)" : "Confirm FG is stable (same reading 3 days apart)",
      n ? "If you can, put the mead in the fridge for 24-48 hours (\"cold crashing\") â€” this makes it crystal clear" : a ? "Cold crash 24-48h if possible" : "Cold crash if possible (chill near-freezing for 48hrs)",
      n ? "Sanitize your bottles, corks or caps, siphon, and tubing" : a ? "Sanitize bottling equipment" : "Prepare and sanitize bottles and equipment",
      n ? "Do a final taste â€” this is what you're bottling!" : a ? "Final QC taste" : "Final taste test",
    ], phase: "aging" });
  }

  // â”€â”€â”€ BOTTLING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const bottlingNote = isStrong
    ? (n ? "Strong meads get WAY better with age â€” try to wait 6-12 months before drinking if you can!" : a ? "Benefit from 6-12+ mo bottle aging" : "Strong meads benefit from 6â€“12+ months of bottle aging")
    : isSession
      ? (n ? "Session meads are ready to drink soon! Give it a couple weeks in the bottle." : a ? "Drinkable in 2-4 weeks" : "Session meads can be enjoyed within a few weeks!")
      : (n ? "Standard meads are good in a few months but keep getting better! Try one at 3 months and save some for 6." : a ? "3-6 mo bottle aging recommended" : "Standard meads improve with 3â€“6 months of bottle aging");

  schedule.push({ day: totalDays, label: n ? `Day ${totalDays} â€” Bottling Day! ğŸ‰` : `Day ${totalDays} â€” Bottling Day!`, tasks: [
    n ? "Siphon the mead one more time off any sediment at the bottom into your bottles" : a ? "Final rack into bottles" : "Rack one final time off any sediment",
    n ? "Fill each bottle leaving about an inch of space at the top (called \"headspace\")" : a ? "Fill leaving 1\" headspace" : "Fill bottles, leaving ~1 inch headspace",
    n ? "Cork or cap the bottles" : a ? "Cork/cap" : "Cork or cap bottles",
    n ? "Label each bottle with the name, date, and what's in it â€” future you will thank present you" : a ? "Label: name, date, OG/FG" : "Label bottles with name, date, and details",
    bottlingNote,
  ], phase: "bottling" });

  // â”€â”€â”€ ENJOY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  if (isStrong) {
    schedule.push({ day: totalDays + 180, label: n ? `Day ${totalDays + 180} â€” Time to Try It! ğŸ¥‚` : `Day ${totalDays + 180} â€” Suggested First Tasting`, tasks: [
      n ? "Open a bottle and enjoy the fruits of your patience!" : "Open a bottle and taste!",
      n ? "Strong meads keep getting better for YEARS â€” save a few bottles and try one every few months to see how it changes" : a ? "Will continue improving for years" : "Strong meads keep improving â€” compare over time",
    ], phase: "enjoy" });
  } else if (!isSession) {
    schedule.push({ day: totalDays + 90, label: n ? `Day ${totalDays + 90} â€” Try Your First Bottle! ğŸ¥‚` : `Day ${totalDays + 90} â€” Suggested First Tasting`, tasks: [
      n ? "Open a bottle! You earned this." : "Open a bottle!",
      n ? "Save some bottles for later â€” mead keeps getting better with age" : a ? "Continue aging remainder" : "Save some for later â€” it keeps getting better",
    ], phase: "enjoy" });
  }

  return schedule;
}

function generateId() {
  return Date.now().toString(36) + Math.random().toString(36).slice(2, 6);
}

// â”€â”€â”€ Style Constants â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

const COLORS = {
  bg: "#0e0c0a",
  surface: "#1a1714",
  surfaceHover: "#252119",
  card: "#1f1b16",
  border: "#3a3228",
  borderLight: "#4a4035",
  gold: "#d4a84b",
  goldLight: "#e8c46f",
  goldDim: "#8a6f30",
  honey: "#f0b429",
  amber: "#c17e2d",
  text: "#e8ddd0",
  textMuted: "#9a8e7e",
  textDim: "#6a5e50",
  accent: "#c44e2f",
  accentLight: "#e06040",
  success: "#5a9a4a",
  successBg: "#1a2a15",
  danger: "#c44e2f",
  dangerBg: "#2a1510",
  warnBg: "#2a2210",
  warnBorder: "#8a6f20",
  infoBg: "#101a2a",
  infoBorder: "#2a5080",
  infoText: "#6aa0d0",
  okBg: "#142014",
  okBorder: "#2a6a2a",
};

// â”€â”€â”€ Warning Display Component â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function WarningPanel({ warnings }) {
  const [collapsed, setCollapsed] = useState({});

  if (!warnings || warnings.length === 0) return null;

  const errors = warnings.filter(w => w.level === "error");
  const warns = warnings.filter(w => w.level === "warn");
  const infos = warnings.filter(w => w.level === "info");
  const oks = warnings.filter(w => w.level === "ok");

  const levelStyle = (level) => {
    switch (level) {
      case "error": return { bg: COLORS.dangerBg, border: COLORS.danger, color: COLORS.accentLight, label: "PROBLEM" };
      case "warn": return { bg: COLORS.warnBg, border: COLORS.warnBorder, color: COLORS.honey, label: "HEADS UP" };
      case "info": return { bg: COLORS.infoBg, border: COLORS.infoBorder, color: COLORS.infoText, label: "NOTE" };
      case "ok": return { bg: COLORS.okBg, border: COLORS.okBorder, color: COLORS.success, label: "NICE" };
      default: return { bg: COLORS.card, border: COLORS.border, color: COLORS.text, label: "" };
    }
  };

  const sortedWarnings = [...errors, ...warns, ...infos, ...oks];

  const summaryColor = errors.length > 0 ? COLORS.danger : warns.length > 0 ? COLORS.honey : COLORS.success;
  const summaryIcon = errors.length > 0 ? "ğŸ›‘" : warns.length > 0 ? "âš ï¸" : oks.length > 0 ? "âœ…" : "â„¹ï¸";
  const summaryText = errors.length > 0
    ? `${errors.length} problem${errors.length > 1 ? "s" : ""} found`
    : warns.length > 0
      ? `${warns.length} thing${warns.length > 1 ? "s" : ""} to consider`
      : oks.length > 0
        ? `Looking good!${infos.length > 0 ? ` (${infos.length} note${infos.length > 1 ? "s" : ""})` : ""}`
        : `${infos.length} note${infos.length > 1 ? "s" : ""}`;

  return (
    <div style={{ marginTop: 16, marginBottom: 16 }}>
      <div style={{
        display: "flex", alignItems: "center", gap: 8, padding: "10px 14px",
        background: COLORS.surface, borderRadius: "10px 10px 0 0", border: `1px solid ${COLORS.border}`,
        borderBottom: "none",
      }}>
        <span style={{ fontSize: 18 }}>{summaryIcon}</span>
        <span style={{ fontSize: 14, fontWeight: 700, color: summaryColor, textTransform: "uppercase", letterSpacing: 1 }}>
          Compatibility Check
        </span>
        <span style={{ fontSize: 13, color: COLORS.textMuted, marginLeft: "auto" }}>{summaryText}</span>
      </div>
      <div style={{ border: `1px solid ${COLORS.border}`, borderRadius: "0 0 10px 10px", overflow: "hidden" }}>
        {sortedWarnings.map((w, idx) => {
          const ls = levelStyle(w.level);
          const isOpen = !collapsed[idx];
          return (
            <div key={idx} style={{
              background: ls.bg, borderBottom: idx < sortedWarnings.length - 1 ? `1px solid ${COLORS.border}` : "none",
              borderLeft: `3px solid ${ls.border}`,
            }}>
              <div
                onClick={() => setCollapsed(prev => ({ ...prev, [idx]: !prev[idx] }))}
                style={{ display: "flex", alignItems: "center", gap: 8, padding: "10px 14px", cursor: "pointer" }}
              >
                <span style={{ fontSize: 16 }}>{w.icon}</span>
                <span style={{ fontSize: 14, fontWeight: 700, color: ls.color, flex: 1 }}>{w.title}</span>
                <span style={{ fontSize: 10, fontWeight: 700, color: ls.color, background: ls.border + "30", padding: "2px 8px", borderRadius: 10, textTransform: "uppercase", letterSpacing: 1 }}>{ls.label}</span>
                <span style={{ color: COLORS.textDim, fontSize: 12, marginLeft: 4 }}>{isOpen ? "â–¾" : "â–¸"}</span>
              </div>
              {isOpen && (
                <div style={{ padding: "0 14px 12px 38px", fontSize: 13, color: COLORS.textMuted, lineHeight: 1.7 }}>
                  {w.detail}
                </div>
              )}
            </div>
          );
        })}
      </div>
    </div>
  );
}

// â”€â”€â”€ Component â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function MeadBrewingApp() {
  const [tab, setTab] = useState("home");
  const [batches, setBatches] = usePersistedState("meadcraft_batches", []);
  const [recipeBuilder, setRecipeBuilder] = useState(null);
  const [viewingBatch, setViewingBatch] = useState(null);
  const [dictSearch, setDictSearch] = useState("");
  const [toastMsg, setToastMsg] = useState(null);
  const [skillLevel, setSkillLevel] = useState(() => {
    try { return localStorage.getItem("meadcraft_skill") || "novice"; } catch { return "novice"; }
  });
  const [expandedSteps, setExpandedSteps] = useState({});
  const [batchDetailNote, setBatchDetailNote] = useState("");
  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);

  useEffect(() => {
    try { localStorage.setItem("meadcraft_skill", skillLevel); } catch {}
  }, [skillLevel]);

  const showToast = (msg) => {
    setToastMsg(msg);
    setTimeout(() => setToastMsg(null), 2500);
  };

  const styles = {
    app: { background: COLORS.bg, color: COLORS.text, minHeight: "100vh", fontFamily: "'Crimson Pro', 'Georgia', serif", position: "relative" },
    container: { maxWidth: 800, margin: "0 auto", padding: "0 20px 100px" },
    nav: { display: "flex", justifyContent: "center", gap: 4, padding: "16px 0", borderBottom: `1px solid ${COLORS.border}`, position: "sticky", top: 0, background: COLORS.bg, zIndex: 50 },
    navBtn: (active) => ({ padding: "10px 16px", border: "none", borderRadius: 8, cursor: "pointer", fontSize: 14, fontWeight: 600, fontFamily: "'Crimson Pro', Georgia, serif", transition: "all 0.2s", background: active ? COLORS.gold : "transparent", color: active ? COLORS.bg : COLORS.textMuted, letterSpacing: 0.5 }),
    h1: { fontSize: 36, fontWeight: 300, color: COLORS.goldLight, textAlign: "center", margin: "32px 0 8px", letterSpacing: 2 },
    h2: { fontSize: 24, fontWeight: 400, color: COLORS.gold, margin: "28px 0 16px", letterSpacing: 1 },
    h3: { fontSize: 18, fontWeight: 600, color: COLORS.goldLight, margin: "20px 0 10px" },
    card: { background: COLORS.card, border: `1px solid ${COLORS.border}`, borderRadius: 12, padding: 20, marginBottom: 16 },
    label: { display: "block", fontSize: 13, color: COLORS.textMuted, marginBottom: 6, fontWeight: 600, textTransform: "uppercase", letterSpacing: 1.5 },
    input: { width: "100%", padding: "10px 14px", background: COLORS.surface, border: `1px solid ${COLORS.border}`, borderRadius: 8, color: COLORS.text, fontSize: 16, fontFamily: "'Crimson Pro', Georgia, serif", outline: "none", boxSizing: "border-box" },
    select: { width: "100%", padding: "10px 14px", background: COLORS.surface, border: `1px solid ${COLORS.border}`, borderRadius: 8, color: COLORS.text, fontSize: 16, fontFamily: "'Crimson Pro', Georgia, serif", outline: "none", boxSizing: "border-box" },
    btnPrimary: { padding: "12px 28px", background: `linear-gradient(135deg, ${COLORS.gold}, ${COLORS.amber})`, color: COLORS.bg, border: "none", borderRadius: 8, fontSize: 16, fontWeight: 700, cursor: "pointer", fontFamily: "'Crimson Pro', Georgia, serif", letterSpacing: 0.5, transition: "all 0.2s" },
    btnSecondary: { padding: "10px 20px", background: "transparent", color: COLORS.gold, border: `1px solid ${COLORS.goldDim}`, borderRadius: 8, fontSize: 14, fontWeight: 600, cursor: "pointer", fontFamily: "'Crimson Pro', Georgia, serif", transition: "all 0.2s" },
    btnDanger: { padding: "10px 20px", background: "transparent", color: COLORS.danger, border: `1px solid ${COLORS.danger}`, borderRadius: 8, fontSize: 14, fontWeight: 600, cursor: "pointer", fontFamily: "'Crimson Pro', Georgia, serif" },
    chip: (active) => ({ display: "inline-block", padding: "6px 14px", margin: "3px", borderRadius: 20, fontSize: 13, cursor: "pointer", border: `1px solid ${active ? COLORS.gold : COLORS.border}`, background: active ? COLORS.goldDim + "40" : COLORS.surface, color: active ? COLORS.goldLight : COLORS.textMuted, transition: "all 0.15s", fontFamily: "'Crimson Pro', Georgia, serif" }),
    badge: (color) => ({ display: "inline-block", padding: "3px 10px", borderRadius: 12, fontSize: 11, fontWeight: 700, textTransform: "uppercase", letterSpacing: 1, background: color === "gold" ? COLORS.goldDim + "30" : color === "green" ? COLORS.successBg : COLORS.dangerBg, color: color === "gold" ? COLORS.gold : color === "green" ? COLORS.success : COLORS.danger }),
    toast: { position: "fixed", bottom: 90, left: "50%", transform: "translateX(-50%)", background: COLORS.gold, color: COLORS.bg, padding: "12px 28px", borderRadius: 8, fontWeight: 700, fontSize: 14, zIndex: 100, boxShadow: "0 4px 20px rgba(0,0,0,0.5)" },
    phaseDot: (phase) => {
      const colors = { prep: COLORS.gold, primary: COLORS.honey, secondary: COLORS.amber, aging: COLORS.goldDim, bottling: COLORS.success, enjoy: COLORS.accentLight };
      return { width: 10, height: 10, borderRadius: "50%", background: colors[phase] || COLORS.textDim, flexShrink: 0, marginTop: 5 };
    },
    timeline: { borderLeft: `2px solid ${COLORS.border}`, marginLeft: 4, paddingLeft: 20 },
  };

  // â”€â”€â”€ Home Page â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const HomePage = () => (
    <div>
      <div style={{ textAlign: "center", padding: "40px 0 20px" }}>
        <div style={{ fontSize: 64, marginBottom: 10 }}>ğŸ¯</div>
        <h1 style={{ ...styles.h1, margin: "0 0 8px" }}>Meadcraft</h1>
        <p style={{ color: COLORS.textMuted, fontSize: 18, fontStyle: "italic", margin: 0 }}>Your Personal Mead Brewing Companion</p>
      </div>

      <div style={{ ...styles.card, borderColor: COLORS.goldDim + "50" }}>
        <label style={styles.label}>Experience Level</label>
        <div style={{ display: "flex", gap: 6 }}>
          {[
            { id: "novice", label: "ğŸŒ± Novice", desc: "Plain language, extra guidance" },
            { id: "intermediate", label: "ğŸ¶ Intermediate", desc: "Terms with brief context" },
            { id: "advanced", label: "âš—ï¸ Advanced", desc: "Technical & concise" },
          ].map(s => (
            <div key={s.id} onClick={() => setSkillLevel(s.id)} style={{ ...styles.chip(skillLevel === s.id), flex: "1 1 auto", textAlign: "center", padding: "10px 8px" }}>
              <div style={{ fontWeight: 700, fontSize: 14 }}>{s.label}</div>
              <div style={{ fontSize: 10, opacity: 0.7, marginTop: 2 }}>{s.desc}</div>
            </div>
          ))}
        </div>
      </div>

      <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 12, marginTop: 16 }}>
        {[
          { icon: "âš—ï¸", title: "Build a Recipe", desc: "Choose sweetness, ABV & ingredients", action: () => { setRecipeBuilder(initRecipeBuilder()); setTab("recipe"); } },
          { icon: "ğŸ“‹", title: "My Batches", desc: `${batches.length} batch${batches.length !== 1 ? "es" : ""} tracked`, action: () => setTab("batches") },
          { icon: "ğŸ“–", title: "Dictionary", desc: "Learn brewing jargon", action: () => setTab("dictionary") },
          { icon: "ğŸ§ª", title: "Quick Start", desc: "Beginner's first mead", action: () => { setRecipeBuilder(quickStartRecipe()); setTab("recipe"); } },
        ].map((item, i) => (
          <div key={i} onClick={item.action} style={{ ...styles.card, cursor: "pointer", textAlign: "center", transition: "all 0.2s", borderColor: COLORS.border }}>
            <div style={{ fontSize: 36 }}>{item.icon}</div>
            <div style={{ fontSize: 16, fontWeight: 700, color: COLORS.goldLight, marginTop: 8 }}>{item.title}</div>
            <div style={{ fontSize: 13, color: COLORS.textMuted, marginTop: 4 }}>{item.desc}</div>
          </div>
        ))}
      </div>

      {batches.length > 0 && (
        <div style={{ marginTop: 28 }}>
          <h2 style={{ ...styles.h2, fontSize: 18 }}>Active Batches</h2>
          {batches.slice(0, 3).map(b => (
            <BatchCard key={b.id} batch={b} onClick={() => { setViewingBatch(b); setExpandedSteps({}); setBatchDetailNote(""); setShowDeleteConfirm(false); setTab("batchDetail"); }} />
          ))}
        </div>
      )}

      {(() => {
        const tip = BEGINNER_TIPS[Math.floor(Math.random() * BEGINNER_TIPS.length)];
        return (
          <div style={{ ...styles.card, marginTop: 28, borderColor: COLORS.goldDim + "40" }}>
            <h3 style={{ ...styles.h3, margin: "0 0 10px" }}>{tip.icon} {tip.title}</h3>
            <p style={{ color: COLORS.textMuted, fontSize: 15, lineHeight: 1.7, margin: 0 }}>
              {tip.tip}
            </p>
            <p style={{ color: COLORS.textDim, fontSize: 11, marginTop: 10, fontStyle: "italic" }}>ğŸ’¡ A new tip appears each time you visit the home page</p>
          </div>
        );
      })()}
    </div>
  );

  // â”€â”€â”€ Recipe Builder â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  function initRecipeBuilder() {
    return { step: 1, sweetness: "semi-sweet", abv: "standard", honeyType: "Wildflower", batchSize: "1", fruits: [], spices: [], extras: [], brewDays: "90", batchName: "", liquid: "water", yeastId: "", fruitTiming: "secondary", spiceTiming: "secondary", editingBatchId: null, brewMethod: "simple" };
  }

  function quickStartRecipe() {
    return { step: 1, sweetness: "semi-sweet", abv: "standard", honeyType: "Orange Blossom", batchSize: "1", fruits: [], spices: [], extras: [], brewDays: "60", batchName: "My First Mead", liquid: "water", yeastId: "", fruitTiming: "secondary", spiceTiming: "secondary", editingBatchId: null, brewMethod: "simple" };
  }

  const RecipeBuilderPage = () => {
    const [rb, setRb] = useState(recipeBuilder || initRecipeBuilder());
    const update = (k, v) => setRb(prev => ({ ...prev, [k]: v }));
    const meadType = classifyMead(rb.fruits, rb.spices, rb.extras);
    const abvTarget = ABV_RANGES.find(a => a.id === rb.abv)?.target || 11;
    const honey = calcHoney(abvTarget, rb.sweetness, parseFloat(rb.batchSize) || 1);
    const recommendedYeast = recommendYeast(abvTarget, rb.sweetness, rb.fruits, rb.spices, rb.extras, rb.liquid);
    const selectedYeast = rb.yeastId ? YEAST_DB.find(y => y.id === rb.yeastId) || recommendedYeast : recommendedYeast;
    const yeast = selectedYeast;
    const schedule = generateSchedule(rb.brewDays, abvTarget, rb.sweetness, rb.fruitTiming, rb.spiceTiming, rb.fruits.length > 0, rb.spices.length > 0, rb.brewMethod, skillLevel);
    const warnings = getCompatibilityWarnings(rb);
    const hasErrors = warnings.some(w => w.level === "error");

    const saveBatch = () => {
      const isEdit = rb.editingBatchId != null;
      const existingBatch = isEdit ? batches.find(b => b.id === rb.editingBatchId) : null;
      const batch = {
        id: isEdit ? rb.editingBatchId : generateId(),
        name: rb.batchName || `${meadType.name} â€” ${new Date().toLocaleDateString()}`,
        meadType, sweetness: rb.sweetness, abv: rb.abv, abvTarget,
        honeyType: rb.honeyType, batchSize: rb.batchSize,
        liquid: rb.liquid, liquidName: LIQUID_BASES.find(l => l.id === rb.liquid)?.name || "Water",
        fruits: [...rb.fruits], spices: [...rb.spices], extras: [...rb.extras],
        fruitTiming: rb.fruitTiming || "secondary", spiceTiming: rb.spiceTiming || "secondary",
        brewMethod: rb.brewMethod || "simple",
        honeyLbs: honey.lbs, og: honey.og, yeast,
        schedule, brewDays: rb.brewDays,
        createdAt: existingBatch?.createdAt || new Date().toISOString(),
        completedSteps: existingBatch?.completedSteps || [],
        notes: existingBatch?.notes || [],
      };
      if (isEdit) {
        setBatches(prev => prev.map(b => b.id === rb.editingBatchId ? batch : b));
      } else {
        setBatches(prev => [batch, ...prev]);
      }
      setViewingBatch(batch);
      setTab("batchDetail");
      showToast(isEdit ? "Recipe updated! ğŸ¯" : "Batch saved! Happy brewing ğŸ¯");
    };

    if (rb.step === 1) return (
      <div>
        <h1 style={styles.h1}>Build Your Recipe</h1>
        <p style={{ textAlign: "center", color: COLORS.textMuted, marginBottom: 28 }}>Choose your style and let Meadcraft build the recipe</p>

        <div style={styles.card}>
          <label style={styles.label}>Brew Method</label>
          <div style={{ display: "flex", gap: 6, marginBottom: 16 }}>
            {[
              { id: "simple", label: "ğŸ¯ Simple", desc: "Mix, pitch, and wait" },
              { id: "technical", label: "ğŸ”¬ Technical", desc: "Rehydration, staggered nutrients, degassing" },
            ].map(m => (
              <div key={m.id} onClick={() => update("brewMethod", m.id)} style={{ ...styles.chip(rb.brewMethod === m.id), flex: "1 1 auto", textAlign: "center", padding: "10px 14px" }}>
                <div style={{ fontWeight: 700 }}>{m.label}</div>
                <div style={{ fontSize: 11, opacity: 0.7, marginTop: 2 }}>{m.desc}</div>
              </div>
            ))}
          </div>
          <p style={{ fontSize: 13, color: COLORS.textMuted, lineHeight: 1.6, fontStyle: "italic" }}>
            {rb.brewMethod === "simple"
              ? "Simple brewing: mix honey and liquid, sprinkle yeast on top, add all nutrient at once, airlock it, and let it do its thing. Fewer steps, less hands-on, still makes great mead."
              : "Technical brewing: rehydrate yeast with Go-Ferm, staggered nutrient additions (TOSNA schedule), daily degassing during primary, multiple gravity readings. More work, more control, potentially better results."}
          </p>
        </div>

        <div style={styles.card}>
          <label style={styles.label}>Sweetness Level</label>
          <div style={{ display: "flex", flexWrap: "wrap", gap: 6, marginBottom: 16 }}>
            {SWEETNESS_LEVELS.map(s => (
              <div key={s.id} onClick={() => update("sweetness", s.id)} style={{ ...styles.chip(rb.sweetness === s.id), padding: "10px 18px", flex: "1 1 auto", textAlign: "center", minWidth: 100 }}>
                <div style={{ fontWeight: 700 }}>{s.name}</div>
                <div style={{ fontSize: 11, opacity: 0.7, marginTop: 2 }}>{s.desc}</div>
              </div>
            ))}
          </div>

          <label style={styles.label}>Strength (ABV)</label>
          <div style={{ display: "flex", flexWrap: "wrap", gap: 6, marginBottom: 16 }}>
            {ABV_RANGES.map(a => (
              <div key={a.id} onClick={() => update("abv", a.id)} style={{ ...styles.chip(rb.abv === a.id), padding: "10px 18px", flex: "1 1 auto", textAlign: "center", minWidth: 120 }}>
                <div style={{ fontWeight: 700 }}>{a.name}</div>
                <div style={{ fontSize: 11, opacity: 0.7, marginTop: 2 }}>{a.range}</div>
              </div>
            ))}
          </div>

          <label style={styles.label}>Batch Size (Gallons)</label>
          <select style={styles.select} value={rb.batchSize} onChange={e => update("batchSize", e.target.value)}>
            {["0.5", "1", "2", "3", "5"].map(v => <option key={v} value={v}>{v} gallon{v !== "1" ? "s" : ""}</option>)}
          </select>
        </div>

        {/* Show ABV+Sweetness compatibility right away */}
        <WarningPanel warnings={warnings.filter(w =>
          w.title.includes("Incompatible") || w.title.includes("Tricky Combo") || w.title.includes("Hot Alcohol")
        )} />

        <div style={{ display: "flex", justifyContent: "flex-end", marginTop: 16 }}>
          <button style={styles.btnPrimary} onClick={() => update("step", 2)}>Next: Ingredients â†’</button>
        </div>
      </div>
    );

    if (rb.step === 2) return (
      <div>
        <h1 style={styles.h1}>Ingredients & Setup</h1>

        <div style={styles.card}>
          <label style={styles.label}>Liquid Base</label>
          <div style={{ display: "flex", flexWrap: "wrap", gap: 6 }}>
            {LIQUID_BASES.map(lb => (
              <div key={lb.id} onClick={() => update("liquid", lb.id)} style={{ ...styles.chip(rb.liquid === lb.id), padding: "8px 14px", display: "flex", alignItems: "center", gap: 6 }}>
                <span>{lb.icon}</span> {lb.name}
              </div>
            ))}
          </div>
          {(() => {
            const sel = LIQUID_BASES.find(l => l.id === rb.liquid);
            return sel ? (
              <div style={{ marginTop: 8 }}>
                <p style={{ fontSize: 14, color: COLORS.goldLight, fontWeight: 600 }}>{sel.icon} {sel.name} â€” {sel.desc}</p>
                <p style={{ fontSize: 13, color: COLORS.textMuted, marginTop: 4 }}>{sel.notes}</p>
              </div>
            ) : null;
          })()}
        </div>

        <div style={styles.card}>
          <label style={styles.label}>Honey Variety</label>
          <select style={styles.select} value={rb.honeyType} onChange={e => update("honeyType", e.target.value)}>
            {HONEY_TYPES.map(h => <option key={h.name} value={h.name}>{h.name} â€” {h.flavor}</option>)}
          </select>
          <p style={{ fontSize: 13, color: COLORS.textMuted, marginTop: 6 }}>
            {HONEY_TYPES.find(h => h.name === rb.honeyType)?.notes}
          </p>
        </div>

        <div style={styles.card}>
          <label style={styles.label}>Fruits (optional â€” makes it a Melomel)</label>
          <div style={{ display: "flex", flexWrap: "wrap" }}>
            {FRUIT_ADDITIONS.map(f => (
              <span key={f} onClick={() => update("fruits", rb.fruits.includes(f) ? rb.fruits.filter(x => x !== f) : [...rb.fruits, f])} style={styles.chip(rb.fruits.includes(f))}>{f}</span>
            ))}
          </div>
          {rb.fruits.length > 0 && (
            <div style={{ marginTop: 12, padding: "12px 14px", background: COLORS.surface, borderRadius: 8, border: `1px solid ${COLORS.border}` }}>
              <label style={{ ...styles.label, marginBottom: 8 }}>When to add fruit?</label>
              <div style={{ display: "flex", gap: 6 }}>
                {[
                  { id: "primary", label: "ğŸ§ª Primary", desc: "Add with must on brew day" },
                  { id: "secondary", label: "ğŸ”¬ Secondary", desc: "Add after racking (recommended)" },
                ].map(t => (
                  <div key={t.id} onClick={() => update("fruitTiming", t.id)} style={{ ...styles.chip(rb.fruitTiming === t.id), flex: "1 1 auto", textAlign: "center", padding: "10px 14px" }}>
                    <div style={{ fontWeight: 700, fontSize: 14 }}>{t.label}</div>
                    <div style={{ fontSize: 11, opacity: 0.7, marginTop: 2 }}>{t.desc}</div>
                  </div>
                ))}
              </div>
              <div style={{ marginTop: 8, fontSize: 13, color: COLORS.textMuted, lineHeight: 1.7, fontStyle: "italic" }}>
                {rb.fruitTiming === "primary"
                  ? "âš¡ Adding fruit in primary gives more fermented, wine-like fruit character. Yeast will consume fruit sugars, producing a drier result with deeper but less \"fresh\" fruit flavor."
                  : "âœ¨ Adding fruit in secondary preserves brighter, fresher fruit character and aroma. Freeze fruit first to break cell walls. Use a sanitized mesh bag for easy removal."}
              </div>
            </div>
          )}
        </div>

        <div style={styles.card}>
          <label style={styles.label}>Spices & Botanicals (optional â€” makes it a Metheglin)</label>
          <div style={{ display: "flex", flexWrap: "wrap" }}>
            {SPICE_ADDITIONS.map(s => (
              <span key={s} onClick={() => update("spices", rb.spices.includes(s) ? rb.spices.filter(x => x !== s) : [...rb.spices, s])} style={styles.chip(rb.spices.includes(s))}>{s}</span>
            ))}
          </div>
          {rb.spices.length > 0 && (
            <div style={{ marginTop: 12, padding: "12px 14px", background: COLORS.surface, borderRadius: 8, border: `1px solid ${COLORS.border}` }}>
              <label style={{ ...styles.label, marginBottom: 8 }}>When to add spices?</label>
              <div style={{ display: "flex", gap: 6 }}>
                {[
                  { id: "primary", label: "ğŸ§ª Primary", desc: "Add with must on brew day" },
                  { id: "secondary", label: "ğŸ”¬ Secondary", desc: "Add after racking (recommended)" },
                ].map(t => (
                  <div key={t.id} onClick={() => update("spiceTiming", t.id)} style={{ ...styles.chip(rb.spiceTiming === t.id), flex: "1 1 auto", textAlign: "center", padding: "10px 14px" }}>
                    <div style={{ fontWeight: 700, fontSize: 14 }}>{t.label}</div>
                    <div style={{ fontSize: 11, opacity: 0.7, marginTop: 2 }}>{t.desc}</div>
                  </div>
                ))}
              </div>
              <div style={{ marginTop: 8, fontSize: 13, color: COLORS.textMuted, lineHeight: 1.7, fontStyle: "italic" }}>
                {rb.spiceTiming === "primary"
                  ? "âš¡ Adding spices in primary extracts bold, deep flavors over weeks. Risk: harder to control intensity."
                  : "âœ¨ Adding spices in secondary gives you control. Taste daily and remove when the flavor is right. Recommended for potent spices like clove and star anise."}
              </div>
            </div>
          )}
        </div>

        <div style={styles.card}>
          <label style={styles.label}>Special Additions</label>
          <div style={{ display: "flex", flexWrap: "wrap" }}>
            {["caramelized", "maple", "malt"].map(e => (
              <span key={e} onClick={() => update("extras", rb.extras.includes(e) ? rb.extras.filter(x => x !== e) : [...rb.extras, e])} style={styles.chip(rb.extras.includes(e))}>
                {e === "caramelized" ? "ğŸ«• Caramelized Honey (Bochet)" : e === "maple" ? "ğŸ Maple Syrup" : "ğŸº Malt (Braggot)"}
              </span>
            ))}
          </div>
        </div>

        <div style={{ ...styles.card, borderColor: COLORS.gold + "30" }}>
          <label style={styles.label}>Yeast</label>
          <select style={styles.select} value={rb.yeastId || recommendedYeast.id} onChange={e => update("yeastId", e.target.value)}>
            {YEAST_DB.map(y => (
              <option key={y.id} value={y.id}>{y.name} â€” Tol: {y.tolerance}% â€” {y.character}{y.id === recommendedYeast.id ? " â˜… Suggested" : ""}</option>
            ))}
          </select>
          {(() => {
            const y = yeast;
            return (
              <div style={{ marginTop: 10 }}>
                <div style={{ display: "flex", alignItems: "center", gap: 8, flexWrap: "wrap", marginBottom: 6 }}>
                  <span style={{ fontSize: 16, fontWeight: 700, color: COLORS.goldLight }}>{y.name}</span>
                  {y.id === recommendedYeast.id && <span style={{ ...styles.badge("gold"), fontSize: 9 }}>â˜… SUGGESTED</span>}
                </div>
                <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 6, fontSize: 14 }}>
                  <div><span style={{ color: COLORS.textMuted }}>Tolerance:</span> <span style={{ color: COLORS.gold }}>{y.tolerance}%</span></div>
                  <div><span style={{ color: COLORS.textMuted }}>Temp:</span> <span style={{ color: COLORS.gold }}>{y.tempRange}</span></div>
                  <div style={{ gridColumn: "1 / -1" }}><span style={{ color: COLORS.textMuted }}>Best for:</span> <span style={{ color: COLORS.text }}>{y.best}</span></div>
                </div>
                <p style={{ color: COLORS.textMuted, fontSize: 13, marginTop: 6, fontStyle: "italic" }}>{y.notes}</p>
                {y.tolerance < abvTarget && (
                  <p style={{ color: COLORS.accentLight, fontSize: 13, marginTop: 4, fontWeight: 600 }}>âš ï¸ Tolerance ({y.tolerance}%) is below target ABV (~{abvTarget}%). May stop early, leaving residual sweetness.</p>
                )}
              </div>
            );
          })()}
        </div>

        <div style={styles.card}>
          <h3 style={{ ...styles.h3, marginTop: 0 }}>ğŸ“… Brewing Timeline</h3>
          <label style={styles.label}>How many days until bottling?</label>
          <div style={{ display: "flex", gap: 8, alignItems: "center", marginBottom: 12 }}>
            <input type="range" min="30" max="365" value={rb.brewDays} onChange={e => update("brewDays", e.target.value)} style={{ flex: 1, accentColor: COLORS.gold }} />
            <input type="number" style={{ ...styles.input, width: 70, textAlign: "center" }} value={rb.brewDays} onChange={e => update("brewDays", e.target.value)} />
            <span style={{ color: COLORS.textMuted, fontSize: 14 }}>days</span>
          </div>
          <p style={{ fontSize: 13, color: COLORS.textMuted, fontStyle: "italic" }}>
            {parseInt(rb.brewDays) < 45 ? "âš¡ Fast turnaround! Expect a young, rough mead." :
              parseInt(rb.brewDays) < 90 ? "â±ï¸ Good timeline for a standard mead." :
                parseInt(rb.brewDays) < 180 ? "ğŸ•°ï¸ Extra aging = smoother results." :
                  "ğŸ† Patient brewer! Long aging produces excellent mead."}
          </p>
        </div>

        <div style={{ ...styles.card, borderColor: COLORS.gold + "40", background: COLORS.goldDim + "10" }}>
          <div style={{ display: "flex", alignItems: "center", gap: 10, marginBottom: 4 }}>
            <span style={{ fontSize: 28 }}>{meadType.icon}</span>
            <div>
              <div style={{ fontSize: 18, fontWeight: 700, color: COLORS.goldLight }}>{meadType.name}</div>
              <div style={{ fontSize: 13, color: COLORS.textMuted }}>{meadType.desc}</div>
            </div>
          </div>
        </div>

        <WarningPanel warnings={warnings} />

        <div style={{ display: "flex", justifyContent: "space-between", marginTop: 16 }}>
          <button style={styles.btnSecondary} onClick={() => update("step", 1)}>â† Back</button>
          <div style={{ display: "flex", alignItems: "center", gap: 12 }}>
            {hasErrors && <span style={{ fontSize: 12, color: COLORS.danger, fontWeight: 600 }}>Fix problems first</span>}
            <button
              style={{ ...styles.btnPrimary, opacity: hasErrors ? 0.4 : 1, cursor: hasErrors ? "not-allowed" : "pointer" }}
              onClick={() => !hasErrors && update("step", 3)}
            >Review Recipe â†’</button>
          </div>
        </div>
      </div>
    );

    if (rb.step === 3) return (
      <div>
        <h1 style={styles.h1}>Recipe Review</h1>
        <div style={{ textAlign: "center", marginBottom: 24 }}>
          <span style={{ fontSize: 48 }}>{meadType.icon}</span>
          <h2 style={{ ...styles.h2, marginTop: 8, marginBottom: 4 }}>{meadType.name}</h2>
          <p style={{ color: COLORS.textMuted }}>{meadType.desc}</p>
        </div>

        <div style={styles.card}>
          <label style={styles.label}>Batch Name (optional)</label>
          <input style={styles.input} value={rb.batchName} onChange={e => update("batchName", e.target.value)} placeholder={`e.g. "Autumn Gold" or "Batch #1"`} />
        </div>

        <div style={styles.card}>
          <h3 style={{ ...styles.h3, marginTop: 0 }}>ğŸ“Š Recipe Summary</h3>
          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 12 }}>
            {[
              ["Batch Size", `${rb.batchSize} gal`],
              ["Target ABV", `~${abvTarget}%`],
              ["Sweetness", SWEETNESS_LEVELS.find(s => s.id === rb.sweetness)?.name],
              ["Est. OG", honey.og],
              ["Honey", `${honey.lbs} lbs ${rb.honeyType}`],
              ["Liquid Base", LIQUID_BASES.find(l => l.id === rb.liquid)?.name || "Water"],
              ["Yeast", yeast.name],
              ["Brew Method", rb.brewMethod === "simple" ? "Simple" : "Technical"],
              ["Timeline", `${rb.brewDays} days`],
            ].map(([k, v]) => (
              <div key={k}>
                <div style={{ fontSize: 11, color: COLORS.textDim, textTransform: "uppercase", letterSpacing: 1 }}>{k}</div>
                <div style={{ fontSize: 16, fontWeight: 600, color: COLORS.goldLight }}>{v}</div>
              </div>
            ))}
          </div>
        </div>

        {(rb.fruits.length > 0 || rb.spices.length > 0) && (
          <div style={styles.card}>
            <h3 style={{ ...styles.h3, marginTop: 0 }}>ğŸ§ª Additions</h3>
            {rb.fruits.length > 0 && (
              <div style={{ marginBottom: rb.spices.length > 0 ? 10 : 0 }}>
                <p style={{ color: COLORS.text, marginBottom: 4 }}>
                  <strong>Fruits:</strong> {rb.fruits.join(", ")}
                  <span style={{ ...styles.badge(rb.fruitTiming === "primary" ? "gold" : "green"), marginLeft: 8, fontSize: 9 }}>
                    {rb.fruitTiming === "primary" ? "In Primary" : "In Secondary"}
                  </span>
                </p>
              </div>
            )}
            {rb.spices.length > 0 && (
              <p style={{ color: COLORS.text, margin: 0 }}>
                <strong>Spices:</strong> {rb.spices.join(", ")}
                <span style={{ ...styles.badge(rb.spiceTiming === "primary" ? "gold" : "green"), marginLeft: 8, fontSize: 9 }}>
                  {rb.spiceTiming === "primary" ? "In Primary" : "In Secondary"}
                </span>
              </p>
            )}
          </div>
        )}

        <WarningPanel warnings={warnings} />

        <div style={styles.card}>
          <h3 style={{ ...styles.h3, marginTop: 0 }}>ğŸ›’ Shopping List</h3>
          <div style={{ fontSize: 15, lineHeight: 2, color: COLORS.text }}>
            {[
              `${honey.lbs} lbs ${rb.honeyType} honey`,
              `${rb.batchSize} gallon${rb.batchSize !== "1" ? "s" : ""} ${LIQUID_BASES.find(l => l.id === rb.liquid)?.name || "spring water"}`,
              `1 packet ${yeast.name}`,
              rb.brewMethod === "technical" ? `Go-Ferm (for yeast rehydration)` : null,
              `Fermaid-O or Fermaid-K (yeast nutrient)`,
              ...(parseInt(rb.batchSize) >= 3 ? [`${rb.batchSize}-gallon fermenter (carboy or bucket)`] : [`1-gallon glass jug or carboy`]),
              `Airlock + bung`,
              `Star San (sanitizer)`,
              `Hydrometer`,
              ...(rb.fruits.map(f => `${f} (2â€“4 lbs/gal, ${rb.fruitTiming === "primary" ? "add on brew day" : "freeze for secondary"})`)),
              ...(rb.spices.map(s => `${s} (start small, ${rb.spiceTiming === "primary" ? "add on brew day" : "add in secondary"})`)),
              ...(rb.sweetness !== "dry" ? ["Potassium sorbate (for stabilizing)", "Campden tablets"] : []),
              `Bottles + corks or caps`,
              `Auto-siphon + tubing`,
            ].filter(Boolean).map((item, i) => (
              <div key={i} style={{ display: "flex", alignItems: "center", gap: 8 }}>
                <span style={{ color: COLORS.goldDim }}>â€¢</span> {item}
              </div>
            ))}
          </div>
        </div>

        <div style={{ display: "flex", justifyContent: "space-between", marginTop: 16, gap: 12, flexWrap: "wrap" }}>
          <button style={styles.btnSecondary} onClick={() => update("step", 2)}>â† Back to Recipe</button>
          <button style={{ ...styles.btnPrimary, opacity: hasErrors ? 0.4 : 1, cursor: hasErrors ? "not-allowed" : "pointer" }} onClick={() => !hasErrors && saveBatch()}>{rb.editingBatchId ? "âœ“ Update Recipe" : "âœ“ Brew This Batch"}</button>
        </div>
      </div>
    );

  };

  // â”€â”€â”€ Batch List â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  const BatchCard = ({ batch, onClick }) => {
    const totalTasks = batch.schedule?.reduce((sum, s) => sum + s.tasks.length, 0) || 1;
    const completedTasks = (batch.completedSteps || []).length;
    const pct = Math.min(100, Math.round((completedTasks / totalTasks) * 100));
    const daysOld = Math.floor((Date.now() - new Date(batch.createdAt).getTime()) / 86400000);

    return (
      <div onClick={onClick} style={{ ...styles.card, cursor: "pointer", display: "flex", gap: 16, alignItems: "center" }}>
        <div style={{ fontSize: 36 }}>{batch.meadType?.icon || "ğŸ¯"}</div>
        <div style={{ flex: 1 }}>
          <div style={{ fontSize: 17, fontWeight: 700, color: COLORS.goldLight }}>{batch.name}</div>
          <div style={{ fontSize: 13, color: COLORS.textMuted }}>{batch.meadType?.name} Â· Day {daysOld} Â· {batch.batchSize} gal</div>
          <div style={{ marginTop: 6, background: COLORS.surface, borderRadius: 4, height: 6, overflow: "hidden" }}>
            <div style={{ height: "100%", width: `${pct}%`, background: `linear-gradient(90deg, ${COLORS.gold}, ${COLORS.amber})`, borderRadius: 4, transition: "width 0.3s" }} />
          </div>
        </div>
        <div style={{ color: COLORS.textDim, fontSize: 13 }}>{pct}%</div>
      </div>
    );
  };

  const BatchListPage = () => (
    <div>
      <h1 style={styles.h1}>My Batches</h1>
      {batches.length === 0 ? (
        <div style={{ textAlign: "center", padding: "60px 0", color: COLORS.textMuted }}>
          <div style={{ fontSize: 48, marginBottom: 12 }}>ğŸ«™</div>
          <p>No batches yet. Build a recipe to get started!</p>
          <button style={{ ...styles.btnPrimary, marginTop: 12 }} onClick={() => { setRecipeBuilder(initRecipeBuilder()); setTab("recipe"); }}>Build a Recipe</button>
        </div>
      ) : (
        batches.map(b => <BatchCard key={b.id} batch={b} onClick={() => { setViewingBatch(b); setExpandedSteps({}); setBatchDetailNote(""); setShowDeleteConfirm(false); setTab("batchDetail"); }} />)
      )}
    </div>
  );

  // â”€â”€â”€ Batch Detail â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  const BatchDetailPage = () => {
    const batch = viewingBatch;
    if (!batch) return null;

    const daysOld = Math.floor((Date.now() - new Date(batch.createdAt).getTime()) / 86400000);

    const updateBatch = (updated) => {
      setViewingBatch(updated);
      setBatches(prev => prev.map(b => b.id === updated.id ? updated : b));
    };

    const toggleTask = (stepIdx, taskIdx) => {
      const key = `${stepIdx}-${taskIdx}`;
      const completed = Array.isArray(batch.completedSteps) ? [...batch.completedSteps] : [];
      if (completed.includes(key)) {
        updateBatch({ ...batch, completedSteps: completed.filter(k => k !== key) });
      } else {
        updateBatch({ ...batch, completedSteps: [...completed, key] });
      }
    };

    const isTaskDone = (stepIdx, taskIdx) => {
      const key = `${stepIdx}-${taskIdx}`;
      const completed = batch.completedSteps || [];
      return completed.includes(key) || completed.includes(stepIdx);
    };

    const getStepProgress = (stepIdx, taskCount) => {
      let done = 0;
      const completed = batch.completedSteps || [];
      if (completed.includes(stepIdx)) return taskCount;
      for (let t = 0; t < taskCount; t++) {
        if (completed.includes(`${stepIdx}-${t}`)) done++;
      }
      return done;
    };

    const toggleExpand = (idx) => {
      setExpandedSteps(prev => ({ ...prev, [idx]: !prev[idx] }));
    };

    const addNote = () => {
      if (!batchDetailNote.trim()) return;
      updateBatch({ ...batch, notes: [...(batch.notes || []), { text: batchDetailNote, date: new Date().toISOString() }] });
      setBatchDetailNote("");
      showToast("Note saved");
    };

    const deleteBatch = () => {
      setBatches(prev => prev.filter(b => b.id !== batch.id));
      setTab("batches");
      setShowDeleteConfirm(false);
      showToast("Batch deleted");
    };

    return (
      <div>
        <button style={{ ...styles.btnSecondary, marginBottom: 16, fontSize: 13, padding: "6px 14px" }} onClick={() => setTab("batches")}>â† All Batches</button>
        <div style={{ textAlign: "center" }}>
          <span style={{ fontSize: 48 }}>{batch.meadType?.icon}</span>
          <h1 style={{ ...styles.h1, marginTop: 8 }}>{batch.name}</h1>
          <p style={{ color: COLORS.textMuted }}>{batch.meadType?.name} Â· Day {daysOld}</p>
          <button style={{ ...styles.btnSecondary, marginTop: 10, fontSize: 13 }} onClick={() => {
            setRecipeBuilder({
              step: 1,
              sweetness: batch.sweetness, abv: batch.abv, honeyType: batch.honeyType,
              batchSize: batch.batchSize, fruits: [...(batch.fruits || [])], spices: [...(batch.spices || [])],
              extras: [...(batch.extras || [])], brewDays: batch.brewDays || "90",
              batchName: batch.name, liquid: batch.liquid || "water",
              yeastId: batch.yeast?.id || "", fruitTiming: batch.fruitTiming || "secondary",
              spiceTiming: batch.spiceTiming || "secondary", editingBatchId: batch.id,
              brewMethod: batch.brewMethod || "simple",
            });
            setTab("recipe");
          }}>âœï¸ Edit Recipe</button>
        </div>

        <div style={{ ...styles.card, display: "grid", gridTemplateColumns: "repeat(3, 1fr)", gap: 12, textAlign: "center" }}>
          {[
            ["Est. ABV", `~${batch.abvTarget}%`],
            ["Est. OG", batch.og],
            ["Honey", `${batch.honeyLbs} lbs`],
          ].map(([k, v]) => (
            <div key={k}>
              <div style={{ fontSize: 11, color: COLORS.textDim, textTransform: "uppercase" }}>{k}</div>
              <div style={{ fontSize: 20, fontWeight: 700, color: COLORS.goldLight }}>{v}</div>
            </div>
          ))}
        </div>

        {skillLevel !== "novice" && (
          <div style={styles.card}>
            <h3 style={{ ...styles.h3, marginTop: 0 }}>ğŸ“ Actual Gravity Readings</h3>
            <p style={{ fontSize: 13, color: COLORS.textMuted, marginBottom: 12 }}>
              {skillLevel === "intermediate" 
                ? "Enter your real hydrometer readings for more accurate ABV tracking."
                : "Record OG/FG for precise ABV calculation."}
            </p>
            <div style={{ display: "flex", gap: 12, flexWrap: "wrap" }}>
              <div style={{ flex: 1, minWidth: 120 }}>
                <label style={{ ...styles.label, fontSize: 11 }}>Actual OG</label>
                <input
                  type="text" inputMode="decimal"
                  style={{ ...styles.input, textAlign: "center", fontSize: 18, fontWeight: 700 }}
                  value={batch.actualOG || ""}
                  placeholder={batch.og || "1.100"}
                  onChange={e => {
                    updateBatch({ ...batch, actualOG: e.target.value });
                  }}
                />
              </div>
              <div style={{ flex: 1, minWidth: 120 }}>
                <label style={{ ...styles.label, fontSize: 11 }}>Actual FG</label>
                <input
                  type="text" inputMode="decimal"
                  style={{ ...styles.input, textAlign: "center", fontSize: 18, fontWeight: 700 }}
                  value={batch.actualFG || ""}
                  placeholder="1.000"
                  onChange={e => {
                    updateBatch({ ...batch, actualFG: e.target.value });
                  }}
                />
              </div>
            </div>
            {(() => {
              const og = parseFloat(batch.actualOG);
              const fg = parseFloat(batch.actualFG);
              if (og > 0 && fg > 0 && og > fg) {
                const actualABV = ((og - fg) * 131.25).toFixed(1);
                return (
                  <div style={{ marginTop: 12, padding: "10px 14px", background: COLORS.goldDim + "20", borderRadius: 8, border: `1px solid ${COLORS.goldDim}30`, textAlign: "center" }}>
                    <div style={{ fontSize: 11, color: COLORS.textDim, textTransform: "uppercase", letterSpacing: 1 }}>Actual ABV</div>
                    <div style={{ fontSize: 28, fontWeight: 700, color: COLORS.goldLight }}>{actualABV}%</div>
                    <div style={{ fontSize: 12, color: COLORS.textMuted }}>({og.toFixed(3)} â†’ {fg.toFixed(3)}) Ã— 131.25</div>
                  </div>
                );
              }
              if (og > 0 && !fg) {
                const maxABV = ((og - 0.990) * 131.25).toFixed(1);
                return (
                  <p style={{ fontSize: 13, color: COLORS.textMuted, marginTop: 8, fontStyle: "italic" }}>
                    With OG of {og.toFixed(3)}, max possible ABV is ~{maxABV}% (if it ferments completely dry). Enter FG when fermentation is done for your actual ABV.
                  </p>
                );
              }
              return null;
            })()}
          </div>
        )}

        <div style={styles.card}>
          <h3 style={{ ...styles.h3, marginTop: 0 }}>Yeast: {batch.yeast?.name}</h3>
          <p style={{ color: COLORS.textMuted, fontSize: 14, margin: 0 }}>{batch.yeast?.notes}</p>
        </div>

        {(batch.fruits?.length > 0 || batch.spices?.length > 0) && (
          <div style={styles.card}>
            <h3 style={{ ...styles.h3, marginTop: 0 }}>ğŸ§ª Additions & Timing</h3>
            {batch.fruits?.length > 0 && (
              <div style={{ marginBottom: batch.spices?.length > 0 ? 12 : 0 }}>
                <div style={{ display: "flex", alignItems: "center", gap: 8, marginBottom: 4 }}>
                  <span style={{ fontWeight: 700, color: COLORS.text }}>Fruits:</span>
                  <span style={styles.badge(batch.fruitTiming === "primary" ? "gold" : "green")}>
                    {batch.fruitTiming === "primary" ? "In Primary" : "In Secondary"}
                  </span>
                </div>
                <p style={{ color: COLORS.textMuted, fontSize: 14, margin: 0 }}>{batch.fruits.join(", ")}</p>
              </div>
            )}
            {batch.spices?.length > 0 && (
              <div>
                <div style={{ display: "flex", alignItems: "center", gap: 8, marginBottom: 4 }}>
                  <span style={{ fontWeight: 700, color: COLORS.text }}>Spices:</span>
                  <span style={styles.badge(batch.spiceTiming === "primary" ? "gold" : "green")}>
                    {batch.spiceTiming === "primary" ? "In Primary" : "In Secondary"}
                  </span>
                </div>
                <p style={{ color: COLORS.textMuted, fontSize: 14, margin: 0 }}>{batch.spices.join(", ")}</p>
              </div>
            )}
          </div>
        )}

        {batch.liquidName && batch.liquidName !== "Spring Water" && (
          <div style={styles.card}>
            <h3 style={{ ...styles.h3, marginTop: 0 }}>ğŸ’§ Liquid Base: {batch.liquidName}</h3>
          </div>
        )}

        <h2 style={styles.h2}>ğŸ“… Schedule</h2>
        <div style={styles.timeline}>
          {batch.schedule?.map((step, idx) => {
            const taskCount = step.tasks.length;
            const doneTasks = getStepProgress(idx, taskCount);
            const allDone = doneTasks === taskCount;
            const isToday = step.day <= daysOld && (idx === batch.schedule.length - 1 || batch.schedule[idx + 1].day > daysOld);
            const isExpanded = expandedSteps[idx] || false;
            const stepDate = new Date(new Date(batch.createdAt).getTime() + step.day * 86400000);
            const dateStr = stepDate.toLocaleDateString(undefined, { month: "short", day: "numeric" });
            const isPast = step.day < daysOld;
            const isFuture = step.day > daysOld;
            return (
              <div key={idx} style={{ marginBottom: 8, position: "relative" }}>
                <div style={{ position: "absolute", left: -26, ...styles.phaseDot(step.phase), border: isToday ? `2px solid ${COLORS.goldLight}` : "none", width: isToday ? 14 : 10, height: isToday ? 14 : 10, marginTop: isToday ? 14 : 16 }} />
                <div style={{
                  borderRadius: 8,
                  background: isExpanded ? COLORS.surface : "transparent",
                  border: isExpanded ? `1px solid ${COLORS.border}` : "1px solid transparent",
                  transition: "all 0.15s",
                }}>
                  {/* HEADER ROW â€” no onClick on this div */}
                  <div style={{ display: "flex", alignItems: "center", gap: 8, padding: "12px 14px", flexWrap: "wrap" }}>
                    {/* ONLY the arrow is clickable for expand/collapse */}
                    <div
                      onClick={() => toggleExpand(idx)}
                      style={{
                        cursor: "pointer", padding: "6px 8px", marginLeft: -6, marginRight: -2,
                        borderRadius: 4, userSelect: "none", WebkitTapHighlightColor: "transparent",
                      }}
                    >
                      <span style={{
                        color: COLORS.gold, fontSize: 13, display: "inline-block",
                        transition: "transform 0.15s", transform: isExpanded ? "rotate(90deg)" : "rotate(0deg)",
                      }}>â–¶</span>
                    </div>
                    <span style={{ fontSize: 15, fontWeight: 700, color: allDone ? COLORS.success : isToday ? COLORS.goldLight : isFuture ? COLORS.text : COLORS.textMuted, flex: 1 }}>
                      {step.label}
                    </span>
                    <span style={{ fontSize: 12, color: isToday ? COLORS.goldLight : COLORS.textDim, fontWeight: isToday ? 700 : 400 }}>{dateStr}</span>
                    {isToday && !allDone && <span style={styles.badge("gold")}>Today</span>}
                    {allDone && <span style={styles.badge("green")}>Done</span>}
                    {!allDone && doneTasks > 0 && (
                      <span style={{ fontSize: 11, color: COLORS.textMuted, fontWeight: 600 }}>{doneTasks}/{taskCount}</span>
                    )}
                  </div>
                  {/* TASK LIST â€” each task has its own checkbox click */}
                  {isExpanded && (
                    <div style={{ padding: "0 14px 14px 38px", borderTop: `1px solid ${COLORS.border}` }}>
                      {step.tasks.map((t, ti) => {
                        const taskDone = isTaskDone(idx, ti);
                        return (
                          <div
                            key={ti}
                            onClick={() => toggleTask(idx, ti)}
                            style={{
                              display: "flex", alignItems: "flex-start", gap: 10,
                              padding: "8px 0", cursor: "pointer",
                              borderBottom: ti < step.tasks.length - 1 ? `1px solid ${COLORS.border}40` : "none",
                              WebkitTapHighlightColor: "transparent",
                            }}
                          >
                            <div style={{
                              width: 22, height: 22, borderRadius: 4, flexShrink: 0, marginTop: 1,
                              border: `2px solid ${taskDone ? COLORS.success : COLORS.goldDim}`,
                              background: taskDone ? COLORS.success : "transparent",
                              display: "flex", alignItems: "center", justifyContent: "center",
                              transition: "all 0.15s",
                            }}>
                              {taskDone && <span style={{ color: COLORS.bg, fontSize: 13, fontWeight: 900 }}>âœ“</span>}
                            </div>
                            <span style={{
                              fontSize: 14, color: taskDone ? COLORS.textDim : COLORS.text,
                              textDecoration: taskDone ? "line-through" : "none",
                              lineHeight: 1.6, transition: "all 0.15s",
                            }}>{t}</span>
                          </div>
                        );
                      })}
                    </div>
                  )}
                </div>
              </div>
            );
          })}
        </div>

        <h2 style={styles.h2}>ğŸ“ Brew Notes</h2>
        <div style={styles.card}>
          <div style={{ display: "flex", gap: 8 }}>
            <input style={{ ...styles.input, flex: 1 }} value={batchDetailNote} onChange={e => setBatchDetailNote(e.target.value)} placeholder="Gravity reading, taste notes, observations..." onKeyDown={e => e.key === "Enter" && addNote()} />
            <button style={styles.btnPrimary} onClick={addNote}>Add</button>
          </div>
          {batch.notes?.length > 0 && (
            <div style={{ marginTop: 12 }}>
              {batch.notes.map((n, i) => (
                <div key={i} style={{ padding: "8px 0", borderBottom: `1px solid ${COLORS.border}`, fontSize: 14 }}>
                  <div style={{ color: COLORS.textDim, fontSize: 11, marginBottom: 2 }}>{new Date(n.date).toLocaleDateString()} {new Date(n.date).toLocaleTimeString()}</div>
                  <div style={{ color: COLORS.text }}>{n.text}</div>
                </div>
              ))}
            </div>
          )}
        </div>

        <div style={{ marginTop: 24 }}>
          {!showDeleteConfirm ? (
            <button style={styles.btnDanger} onClick={() => setShowDeleteConfirm(true)}>Delete Batch</button>
          ) : (
            <div style={{ ...styles.card, borderColor: COLORS.danger }}>
              <p style={{ color: COLORS.danger, fontWeight: 600 }}>Are you sure? This cannot be undone.</p>
              <div style={{ display: "flex", gap: 8 }}>
                <button style={styles.btnDanger} onClick={deleteBatch}>Yes, Delete</button>
                <button style={styles.btnSecondary} onClick={() => setShowDeleteConfirm(false)}>Cancel</button>
              </div>
            </div>
          )}
        </div>
      </div>
    );
  };

  // â”€â”€â”€ Dictionary â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  const DictionaryPage = () => {
    const filtered = DICTIONARY.filter(d =>
      d.term.toLowerCase().includes(dictSearch.toLowerCase()) ||
      d.def.toLowerCase().includes(dictSearch.toLowerCase())
    );

    return (
      <div>
        <h1 style={styles.h1}>Brewer's Dictionary</h1>
        <p style={{ textAlign: "center", color: COLORS.textMuted, marginBottom: 20 }}>Tap any term to learn what it means</p>
        <input style={{ ...styles.input, marginBottom: 20 }} value={dictSearch} onChange={e => setDictSearch(e.target.value)} placeholder="Search terms..." />
        {filtered.map((d, i) => (
          <div key={i} style={{ ...styles.card, padding: 16, marginBottom: 8 }}>
            <div style={{ fontSize: 16, fontWeight: 700, color: COLORS.gold }}>{d.term}</div>
            <div style={{ fontSize: 14, color: COLORS.textMuted, marginTop: 4, lineHeight: 1.6 }}>{d.def}</div>
          </div>
        ))}
      </div>
    );
  };

  // â”€â”€â”€ Yeast Guide â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  const YeastGuidePage = () => (
    <div>
      <h1 style={styles.h1}>Yeast Guide</h1>
      <p style={{ textAlign: "center", color: COLORS.textMuted, marginBottom: 20 }}>Common wine/mead yeasts and their characteristics</p>
      {YEAST_DB.map(y => (
        <div key={y.id} style={styles.card}>
          <div style={{ fontSize: 18, fontWeight: 700, color: COLORS.goldLight }}>{y.name}</div>
          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 8, marginTop: 10, fontSize: 14 }}>
            <div><span style={{ color: COLORS.textDim }}>Tolerance:</span> <span style={{ color: COLORS.gold }}>{y.tolerance}%</span></div>
            <div><span style={{ color: COLORS.textDim }}>Temp Range:</span> <span style={{ color: COLORS.gold }}>{y.tempRange}</span></div>
            <div><span style={{ color: COLORS.textDim }}>Character:</span> <span style={{ color: COLORS.text }}>{y.character}</span></div>
            <div><span style={{ color: COLORS.textDim }}>Best For:</span> <span style={{ color: COLORS.text }}>{y.best}</span></div>
          </div>
          <p style={{ color: COLORS.textMuted, fontSize: 13, marginTop: 8, fontStyle: "italic" }}>{y.notes}</p>
        </div>
      ))}
    </div>
  );

  // â”€â”€â”€ Render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  const pages = { home: HomePage, recipe: RecipeBuilderPage, batches: BatchListPage, batchDetail: BatchDetailPage, dictionary: DictionaryPage, yeast: YeastGuidePage };
  const Page = pages[tab] || HomePage;

  return (
    <div style={styles.app}>
      <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:ital,wght@0,300;0,400;0,600;0,700;1,400&display=swap" rel="stylesheet" />
      <div style={styles.container}>
        <Page />
      </div>

      {/* Bottom Nav */}
      <div style={{ position: "fixed", bottom: 0, left: 0, right: 0, background: COLORS.surface, borderTop: `1px solid ${COLORS.border}`, zIndex: 50 }}>
        <div style={{ display: "flex", justifyContent: "center", maxWidth: 500, margin: "0 auto" }}>
          {[
            { id: "home", icon: "ğŸ ", label: "Home" },
            { id: "recipe", icon: "âš—ï¸", label: "Recipe" },
            { id: "batches", icon: "ğŸ“‹", label: "Batches" },
            { id: "yeast", icon: "ğŸ§«", label: "Yeast" },
            { id: "dictionary", icon: "ğŸ“–", label: "Dict" },
          ].map(n => (
            <div key={n.id} onClick={() => { if (n.id === "recipe" && !recipeBuilder) setRecipeBuilder(initRecipeBuilder()); setTab(n.id); }}
              style={{ flex: 1, textAlign: "center", padding: "10px 0 8px", cursor: "pointer", color: tab === n.id ? COLORS.gold : COLORS.textDim, transition: "color 0.2s" }}>
              <div style={{ fontSize: 20 }}>{n.icon}</div>
              <div style={{ fontSize: 10, marginTop: 2, fontWeight: 600, letterSpacing: 0.5 }}>{n.label}</div>
            </div>
          ))}
        </div>
      </div>

      {/* Toast */}
      {toastMsg && <div style={styles.toast}>{toastMsg}</div>}
    </div>
  );
}


ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(MeadBrewingApp));
</script>
</body>
</html>